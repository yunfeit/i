var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},SpriteEx=function(t){function e(e,i,s,a,r){void 0===i&&(i=null),void 0===s&&(s=0),void 0===a&&(a=0),void 0===r&&(r="normal");var o=t.call(this)||this;return o.p_x=0,o.p_y=0,o.velocity=0,o.texture=RES.getRes(e),o.texture||console.error(e+" Texture not found!"),o.display(),o.positionFix(r),o.x=s,o.y=a,i&&i.addChild(o),o}return __extends(e,t),e.prototype.display=function(){this.body=new egret.Bitmap,this.body.texture=this.texture,this.addChild(this.body),this.width=this.body.width,this.height=this.body.height,windspirit.Util.setCenterAnchor(this)},e.prototype.toggleDisplay=function(){this.visible=!this.visible},e.prototype.scale=function(t){this.scaleX=this.scaleY=t},e.prototype.positionFix=function(t){switch(t){default:console.warn("not support!"+t);case"custom":case"normal":this.anchorOffsetX=this.anchorOffsetY=0;break;case"center":windspirit.Util.setCenterAnchor(this)}},e}(egret.Sprite);__reflect(SpriteEx.prototype,"SpriteEx");var Tree=function(t){function e(){var e=t.call(this)||this;return e.skinName="TreeSkin",e.redpacket.visible=!1,e}return __extends(e,t),e}(eui.Component);__reflect(Tree.prototype,"Tree");var FlappyEvents=function(t){function e(e,i,s){void 0===i&&(i=!1),void 0===s&&(s=!1);var a=t.call(this,e,i,s)||this;return a.status=GameStatus.HELLO,a.flappy=null,a.ground=null,a.score=null,a.score_min=null,a}return __extends(e,t),e}(egret.Event);FlappyEvents.GAME_RUN="gameRun",__reflect(FlappyEvents.prototype,"FlappyEvents");var GameApi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.get_lottery=function(t,e){var i={gameid:windspirit.Config.gameId,openid:windspirit.Config.openId,score:t};this.doHttpGet(this.URL_YIPAY,i,e)},e}(windspirit.Net);GameApi.URL_YIPAY="http://www.windspirit.cn/Game/getLottery",__reflect(GameApi.prototype,"GameApi");var GameLayer=function(t){function e(){var e=t.call(this)||this;return e.skinName="GameSkin",e}return __extends(e,t),e}(eui.Component);__reflect(GameLayer.prototype,"GameLayer");var GameOverLayer=function(t){function e(e){var i=t.call(this)||this;return i.skinName="GameOverSkin",i.btnRetry.addEventListener(egret.TouchEvent.TOUCH_TAP,i.retry,i),windspirit.GameData.score=e,i.scrollH=305,i.url="",i.btnLink.addEventListener(egret.TouchEvent.TOUCH_TAP,i.openLink,i),i.postGroup.mask=new egret.Rectangle(0,0,windspirit.Util.stageW,i.scrollH),i.scrollInfo(),i.addEventListener(egret.Event.ENTER_FRAME,i.update,i),i.postTouchGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,i.postTouch,i),i}return __extends(e,t),e.prototype.retry=function(){windspirit.GameAPI.runApi(windspirit.api.restartGame)},e.prototype.scrollInfo=function(){this.postGroup.y=736,egret.Tween.get(this.postGroup).to({y:736-this.scrollH},5e3).call(this.scrollInfo,this)},e.prototype.get_lottery_cb=function(t){if(t.type!=egret.IOErrorEvent.IO_ERROR){var e=t.target,i=JSON.parse(e.data);i.url&&(this.url=i.url,this.btnRetry.source="btn_get",this.btnRetry.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.retry,this),this.btnRetry.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touch,this))}},e.prototype.postTouch=function(){window.open("post.html")},e.prototype.update=function(){this.postGroup.mask=new egret.Rectangle(0,736-this.postGroup.y,windspirit.Util.stageW,this.scrollH)},e.prototype.touch=function(){this.url&&window.open(this.url)},e.prototype.openLink=function(){window.open("http://x.eqxiu.com/s/D2Kck4ap")},e}(eui.Component);__reflect(GameOverLayer.prototype,"GameOverLayer");var Constant=function(){function t(){}return t.trace=function(e){t.debug&&console.log(e)},t}();Constant.version="0.0.9 dev 0.3",Constant.debug=!1,__reflect(Constant.prototype,"Constant");var GameVar=function(){function t(){}return t.world_g=function(){return 4e-4*GlobalVar.stage_height()*GlobalVar.FPSoffset()},t.world_speed=function(){return.005*GlobalVar.stage_width()*GlobalVar.FPSoffset()},t.obs_vertic_space=function(){return.38*GlobalVar.stage_height()},t.tap_velocity=function(){return GlobalVar.stage_height()*this.tap_rate},t.flappy_level=function(){var e=1;return t.obs_conut>=5&&e++,t.obs_conut>=10&&e++,e},t.obs_density=function(){return GlobalVar.stage_width()>GlobalVar.stage_height()?.3*GlobalVar.stage_width():GlobalVar.stage_width()},t}();GameVar.flappy_pos=100,GameVar.tap_rate=.008,GameVar.tap_conut=0,GameVar.obs_conut=0,__reflect(GameVar.prototype,"GameVar");var GlobalVar=function(){function t(){}return t.FPSoffset=function(e){return void 0===e&&(e=60),e/t.FPS},t.stage_width=function(){return egret.MainContext.instance.stage.stageWidth},t.stage_height=function(){return egret.MainContext.instance.stage.stageHeight},t}();__reflect(GlobalVar.prototype,"GlobalVar");var GlobalFun=function(){function t(){}return t.randRange=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},t}();__reflect(GlobalFun.prototype,"GlobalFun");var GameStatus;!function(t){t[t.HELLO=1]="HELLO",t[t.READY=2]="READY",t[t.PLAYING=3]="PLAYING",t[t.OVER=4]="OVER"}(GameStatus||(GameStatus={}));var Main=function(t){function e(){return t.call(this,{appId:"flappybird",heart:!1,debug:!1,showLogo:!1})||this}return __extends(e,t),e.prototype.createGameScene=function(){this.gameLayer.removeChildren(),this.gameController=new GameController(this.gameLayer)},e.prototype.restart=function(){this.createGameScene()},e}(windspirit.App);__reflect(Main.prototype,"Main");var GameController=function(){function t(t){this.game=new GameLiveCircleModel(t,this),this.allLoaded()}return t.prototype.allLoaded=function(){this.game.pre(),this.game.UI.addEventListener(FlappyEvents.GAME_RUN,this.run,this),this.game.hell()},t.prototype.run=function(t){switch(t.status){case GameStatus.HELLO:windspirit.SoundManager.playSound("bg"),Constant.trace("Hello Face!");break;case GameStatus.READY:this.game.gameready(t);break;case GameStatus.PLAYING:windspirit.SoundManager.playSound("bg"),this.game.playing(t);break;case GameStatus.OVER:this.game.gameover(t)}},t}();__reflect(GameController.prototype,"GameController");var SimpleYH=function(t){function e(e){void 0===e&&(e=!0);var i=t.call(this,"yanhua")||this;return i.isPool=!0,i.isPool=e,windspirit.Util.setCenterAnchor(i),i.alpha=0,i.scaleX=i.scaleY=.1,i}return __extends(e,t),e.prototype.play=function(){this.alpha=1;var t=.6*Math.random()+.4,e=this.y;egret.Tween.get(this).to({scaleX:t,scaleY:t},200).to({scaleX:t+.2,scaleY:t+.2,alpha:0,y:e+5},500).call(this.reset,this)},e.prototype.reset=function(){egret.Tween.removeTweens(this),this.scaleX=this.scaleY=.1,this.alpha=0,windspirit.Util.safeRemove(this),this.isPool&&e.pool.push(this)},e}(SpriteEx);SimpleYH.pool=[],__reflect(SimpleYH.prototype,"SimpleYH");var Bird=function(t){function e(){var e=t.call(this,"obj_flappy")||this;return e.velocity=0,windspirit.Util.setCenterAnchor(e),e}return __extends(e,t),e.prototype.live=function(){this.texture=RES.getRes("obj_flappy")},e.prototype.die=function(){this.texture=RES.getRes("birdie2")},e}(windspirit.Bitmap);__reflect(Bird.prototype,"Bird");var Button=function(t){function e(e,i,s,a,r){void 0===i&&(i=null),void 0===s&&(s=0),void 0===a&&(a=0),void 0===r&&(r="normal");var o=t.call(this,e,i,s,a,r)||this;return o.touchEnabled=!0,o}return __extends(e,t),e}(SpriteEx);__reflect(Button.prototype,"Button");var GameDisplay=function(t){function e(){var e=t.call(this)||this;return e.event=new FlappyEvents(FlappyEvents.GAME_RUN),e.touchEnabled=!0,e}return __extends(e,t),e.prototype.addBackground=function(){this.background=new egret.Bitmap,this.background.texture=RES.getRes("background"),this.background.fillMode=egret.BitmapFillMode.SCALE,this.background.height=GlobalVar.stage_height(),this.background.width=GlobalVar.stage_width(),this.addChild(this.background)},e.prototype.helloPlay=function(){this.startLayer=new windspirit.StartLayer,this.addChild(this.startLayer),this.gameLayer=new GameLayer,this.addChild(this.gameLayer),this.event.score=this.gameLayer.fontScore,this.event.ground=new Ground("obj_ground",GlobalVar.stage_width()),this.event.ground.visible=!1,this.addChild(this.event.ground),this.dispatchEvent(this.event),this.initGame()},e.prototype.initGame=function(){this.event.flappy?(this.event.flappy.rotation=0,this.event.flappy.x=100,this.event.flappy.y=this.event.ground.level>>1):(this.event.flappy=new Bird,this.event.flappy.x=GameVar.flappy_pos,this.event.flappy.y=this.event.ground.level>>1,this.addChild(this.event.flappy)),this.event.status=GameStatus.READY,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.startPlay,this),this.dispatchEvent(this.event)},e.prototype.startPlay=function(){this.startLayer.visible=!1,this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.startPlay,this),this.event.status=GameStatus.PLAYING,this.dispatchEvent(this.event)},e.prototype.overPlay=function(){this.event.status=GameStatus.OVER,this.dispatchEvent(this.event)},e.prototype.displayOverDialog=function(){var t=new GameOverLayer(parseInt(this.event.score.text));this.addChild(t)},e}(egret.DisplayObjectContainer);__reflect(GameDisplay.prototype,"GameDisplay");var Ground=function(t){function e(e,i,s,a){void 0===s&&(s=0),void 0===a&&(a=null);var r=t.call(this)||this;return r.u_width=0,r.Width=0,r.level=0,r.level=s,r.texture=RES.getRes(e),r.create(i),r}return __extends(e,t),e.prototype.create=function(t){for(;this.Width<t;)this.addsoli(this.Width);this.addsoli(this.Width)},e.prototype.addsoli=function(t){var e=new egret.Bitmap;e.texture=this.texture,e.x=t,this.level=e.y=GlobalVar.stage_height()-e.height,this.Width+=e.width,this.addChild(e),this.u_width=e.width},e.prototype.animate=function(){this.x-=GameVar.world_speed(),this.x<=-this.u_width&&(this.x=0)},e}(egret.DisplayObjectContainer);__reflect(Ground.prototype,"Ground");var Obstacle=function(t){function e(i,s,a,r){var o=t.call(this)||this;return o.Width=0,o._top=0,o._bot=0,o.posX=0,e.count++,e.count>1?(o.banner2.visible=!1,o.tip.visible=!0,o.firstBanner.visible=!1,o.tip.source="tip"+(e.count%6+1)):(o.banner2.visible=!0,o.banner.visible=!1,o.firstBanner.visible=!0,o.tip.visible=!1),o.posX=s,o.Width=113,o._top=a,o._bot=a+r,o}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.createChildren.call(this),windspirit.Util.setCenterAnchor(this.mid_obj),windspirit.Util.setCenterAnchor(this.redpacket),this.display(this.posX)},e.prototype.display=function(t){this.yanhua=new SimpleYH(!1),this.other_group.addChildAt(this.yanhua,0),this.top_tree.height=this.top-133,this.top_tree.anchorOffsetY=this.top_tree.height,this.top_tree.y=this.top,this.tip.anchorOffsetX=this.tip.width>>1,this.tip.x=this.banner.x,this.topEnd.y=this.top+37,this.mid_obj.y=this.bot+this.top>>1,this.redpacket.x=this.mid_obj.x,this.yanhua.x=this.mid_obj.x,this.yanhua.y=this.mid_obj.y,this.yanhua.visible=!1,this.botEnd.y=this.bot-37,this.bot_tree.height=windspirit.Util.stageH-this.bot,this.bot_tree.y=this.bot,this.top_tree.x=this.bot_tree.x=t,this.other_group.x=t-335},e.prototype.showYanhua=function(){this.mid_obj.visible=!1,this.redpacket.scaleX=0,this.redpacket.scaleY=0,this.redpacket.visible=!0,egret.Tween.get(this.redpacket).to({scaleX:1,scaleY:1},500),this.yanhua.visible=!0,this.yanhua.play()},Object.defineProperty(e.prototype,"top",{get:function(){return this._top},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bot",{get:function(){return this._bot},enumerable:!0,configurable:!0}),e}(Tree);Obstacle.count=0,__reflect(Obstacle.prototype,"Obstacle");var GameLiveCircleModel=function(){function t(t,e){this.obstacles=[],this.obstacles_pass=[],this.curr_top=0,this.curr_bot=0,this.disatace_listen=0,this._lastTime=0,this.stage=t,this.UI=new GameDisplay}return t.prototype.pre=function(){this.UI.addBackground(),this.stage.addChild(this.UI)},t.prototype.hell=function(){this.UI.helloPlay()},t.prototype.gameready=function(t){Obstacle.count=0,this.stage.removeEventListener(egret.Event.ENTER_FRAME,this._die,this),this.score&&(this.score.text="0");for(var e=0;e<this.obstacles.length;e++)this.UI.removeChild(this.obstacles[e]);for(var e=0;e<this.obstacles_pass.length;e++)this.UI.removeChild(this.obstacles_pass[e]);this.obstacles=[],this.obstacles_pass=[],this.flappy=t.flappy,this.ground=t.ground,this.flappy.live(),this.score=t.score,this._flappyfloat(1),this.stage.addEventListener(egret.Event.ENTER_FRAME,this._scene,this)},t.prototype.playing=function(t){egret.Tween.removeTweens(this.flappy),Constant.trace("Flappy!"),this.curr_top=0,this.curr_bot=t.ground.level,this.flappy.velocity=.016*-GlobalVar.stage_height(),this.stage.addEventListener(egret.Event.ENTER_FRAME,this.update,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._ontab,this)},t.prototype.gameover=function(t){this.stage.removeEventListener(egret.Event.ENTER_FRAME,this.update,this),this.stage.removeEventListener(egret.Event.ENTER_FRAME,this._scene,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this._ontab,this),this.curr_top=0,this.curr_bot=t.ground.level,this.stage.addEventListener(egret.Event.ENTER_FRAME,this._die,this),GameVar.obs_conut=0,GameVar.tap_conut=0},t.prototype._flappyfloat=function(t){var e=egret.Tween.get(this.flappy);e.to({x:100,y:(this.ground.level>>1)-20*t},500,egret.Ease.sineIn).call(this._flappyfloat,this,[-1*t])},t.prototype._scene=function(){var t=egret.getTimer();GlobalVar.FPS=1e3/(t-this._lastTime),this._lastTime=t,this.ground.animate()},t.prototype.update=function(){this.curr_top=0,this.curr_bot=this.ground.level;var t=1.5*GlobalVar.stage_width();if(0==this.disatace_listen){var e=GlobalFun.randRange(GlobalVar.stage_height()/5,GlobalVar.stage_height()/3),i=GameVar.obs_vertic_space();Obstacle.count>7&&(i=330),Obstacle.count>10&&(i=310),Obstacle.count>14&&(i=300),Obstacle.count>19&&(i=280);var s=new Obstacle("obj_obstacle",t,e,i);this.obstacles.push(s),this.UI.addChild(s),this.flappy.parent.setChildIndex(this.flappy,this.flappy.parent.numChildren+1),this.ground.parent.setChildIndex(this.ground,this.ground.parent.numChildren+1),this.UI.setChildIndex(this.UI.gameLayer,this.UI.numChildren+1)}for(var a=0;a<this.obstacles.length;a++){var r=this.obstacles[a];this.obstacles[a].x-=GameVar.world_speed();var o=this.obstacles[a].x+t+(this.obstacles[a].Width>>1);if(o>GameVar.flappy_pos&&o<GameVar.flappy_pos+this.obstacles[a].Width+(this.flappy.height>>1)&&(this.curr_top=this.obstacles[a].top,this.curr_bot=this.obstacles[a].bot,r.showYanhua()),o<GameVar.flappy_pos-(this.flappy.height>>1)){this.obstacles[a].x+=2*GameVar.world_speed(),this.obstacles_pass.push(this.obstacles.shift()),GameVar.obs_conut++,GameVar.obs_conut>=0&&(this.score.text=GameVar.obs_conut+"");break}}for(var a=0;a<this.obstacles_pass.length;a++){this.obstacles_pass[a].x-=GameVar.world_speed();var o=this.obstacles_pass[a].x+t+(this.obstacles_pass[a].Width>>1);if(-500>o){var s=this.obstacles_pass.shift();this.UI.removeChild(s);break}}this.disatace_listen+=GameVar.world_speed(),this.disatace_listen>=GameVar.obs_density()&&(this.disatace_listen=0),this.flappy.y+(this.flappy.height>>1)<=this.curr_bot&&this.flappy.y-(this.flappy.height>>1)>=this.curr_top?this._gravity(this.flappy):(this.addSpeak(),this.flappy.die(),this.flappy.velocity=.3*-this.flappy.velocity,this.UI.overPlay())},t.prototype.addSpeak=function(){var t=new windspirit.Bitmap("word");t.x=200,t.y=400,this.stage.addChild(t),this.actorSpeak=t},t.prototype._die=function(t){this.flappy.y+(this.flappy.height>>1)<=this.curr_bot&&this.flappy.y-(this.flappy.height>>1)>=this.curr_top?this._gravity(this.flappy):(windspirit.Util.safeRemove(this.actorSpeak),this.UI.displayOverDialog(),this.stage.removeEventListener(egret.Event.ENTER_FRAME,this._die,this))},t.prototype._ontab=function(){this.flappy.rotation=-20,this.flappy.velocity=-GameVar.tap_velocity(),GameVar.tap_conut++},t.prototype._gravity=function(t){var e=GameVar.world_g();t.velocity+=e,t.rotation+=.5*GlobalVar.FPSoffset(),t.y+=t.velocity*GlobalVar.FPSoffset()},t}();__reflect(GameLiveCircleModel.prototype,"GameLiveCircleModel");