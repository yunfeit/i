var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},BasePanel=function(t){function e(){var e=t.call(this)||this;return e.mediatorName="",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.touchChildren=e.touchEnabled=!0,e}return __extends(e,t),e.prototype.onAddToStage=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveToStage,this),this.init()},e.prototype.onRemoveToStage=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveToStage,this),0<this.mediatorName.length&&ApplicationFacade.getInstance().removeMediator(this.mediatorName)},e.prototype.init=function(){},e.prototype.shadowBg=function(t){t&&(this.graphics.beginFill(0,.4),this.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),this.graphics.endFill())},e}(egret.Sprite);__reflect(BasePanel.prototype,"BasePanel");var BaseScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(egret.DisplayObjectContainer);__reflect(BaseScene.prototype,"BaseScene");var GameMapAnimationMgr=function(){function t(){this.isPlaying=!1,this.playingCount=0}return t.prototype.init=function(t){return this.anEvent=new GameAnimationEvent(GameAnimationEvent.COMPLETE),this.gameMap=t,this},t.prototype.reset=function(){this.playingCount=0,this.isPlaying=!1,this.anEvent=this.gameMap=null},t.prototype.updateEF=function(){this.isPlaying&&this.playingCount<1&&(this.isPlaying=!1,this.gameMap.dispatchEvent(this.anEvent))},t.prototype.addPlaying=function(t){return void 0===t&&(t=1),this.playingCount+=t,this.isPlaying=!0,this.playingCount},t.prototype.overCount=function(t){return void 0===t&&(t=1),this.playingCount-=t},Object.defineProperty(t,"ins",{get:function(){return null==t._ins&&(t._ins=new t),t._ins},enumerable:!0,configurable:!0}),t}();GameMapAnimationMgr._ins=null,__reflect(GameMapAnimationMgr.prototype,"GameMapAnimationMgr");var GameFinishCommand=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.execute=function(t){t.getBody(),console.log("GameFinishCommand"),GameMgr.ins.reset(),this.sendNotification(ApplicationFacade.CHANGE_SCENE,0,UIConfig.SceneADD)},e}(puremvc.SimpleCommand);__reflect(GameFinishCommand.prototype,"GameFinishCommand");var GameOverCommand=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.execute=function(t){t.getBody(),console.log("GameOverCommand");var e=GameMgr.ins;switch(t=e.gameModel.levelVo,t.gameType){case 0:case 1:this.sendNotification(ApplicationFacade.CHANGE_PANEL,3,UIConfig.PanelADD);var i=e.gameModel.stateProxy.getModel().clearAllNum,n=this.facade.retrieveProxy(RankProxy.NAME);0==t.gameType&&(n.model.localMoveRank=i);break;case 2:this.sendNotification(ApplicationFacade.CHANGE_PANEL,2,UIConfig.PanelADD)}GameMgr.ins.pauseGame()},e}(puremvc.SimpleCommand);__reflect(GameOverCommand.prototype,"GameOverCommand");var GamePauseCommand=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.execute=function(t){t.getBody(),GameMgr.ins.pauseGame(),this.sendNotification(ApplicationFacade.CHANGE_PANEL,1,UIConfig.PanelADD)},e}(puremvc.SimpleCommand);__reflect(GamePauseCommand.prototype,"GamePauseCommand");var ModelPrepCommand=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.execute=function(){this.facade.registerProxy(new LevelProxy),this.facade.registerProxy(new RankProxy)},e}(puremvc.SimpleCommand);__reflect(ModelPrepCommand.prototype,"ModelPrepCommand");var OnGetRankCommand=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.execute=function(t){this.gameType=t.getBody();var e=this.facade.retrieveProxy(RankProxy.NAME),i=e.model,n=i.moveRankList,o=n.length;console.log(o),0==o?(this.parseData(),this.submitRank()):(console.log("get rank"),this.urlloader=new egret.URLLoader,this.urlloader.dataFormat=egret.URLLoaderDataFormat.TEXT,t=new egret.URLRequest,t.url=URLConst.moveRank,t.method=egret.URLRequestMethod.POST,this.urlloader.load(t),this.urlloader.addEventListener(egret.Event.COMPLETE,this.onComplete,this))},e.prototype.onComplete=function(t){this.facade.retrieveProxy(RankProxy.NAME).model.rawMoveRankList=JSON.parse(this.urlloader.data),this.parseData()},e.prototype.parseData=function(){var t=this.facade.retrieveProxy(RankProxy.NAME),e=t.model,i=e.rawMoveRankList;e.moveRankList.length=0;var n=e.moveRankList,o=i.length,a=!1;if(0==o)this.submitRank();else for(var s=0;o>s;s++){var r=i[s],h=new RankListVo;if(h.nickName=r.nickname,h.rank=r.rank,h.date=r.date,r=t.model.localMoveRank,r>h.rank&&!a){var l=new RankListVo;l.nickName="your scores",l.rank=r,n.push(l),a=!0,l.isLocal=!0,this.submitRank()}n.push(h),h.rank<e.rankLowest&&!a&&(e.rankLowest=h.rank)}this.sendNotification(ServiceCommand.UPDATA_RANK,this.gameType)},e.prototype.submitRank=function(){console.log("submitRank");var t=this.facade.retrieveProxy(RankProxy.NAME),e=t.model,i=t.model.localMoveRank;this.sendNotification(ServiceCommand.SUBMIT_RANK),i>0&&i>e.rankLowest&&(console.log("aaaa"),this.sendNotification(ServiceCommand.SUBMIT_RANK))},e}(puremvc.SimpleCommand);__reflect(OnGetRankCommand.prototype,"OnGetRankCommand");var ServiceCommand=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.register=function(){this.facade.registerCommand(e.SUBMIT_RANK,SubmitRankCommand),this.facade.registerCommand(e.GET_RANK,OnGetRankCommand)},e.prototype.execute=function(t){t.getBody(),t.getName()},e}(puremvc.SimpleCommand);ServiceCommand.NAME="ServiceCommand",ServiceCommand.SUBMIT_RANK="submit_rank",ServiceCommand.GET_RANK="get_rank",ServiceCommand.UPDATA_RANK="updata_rank",__reflect(ServiceCommand.prototype,"ServiceCommand");var StartNewGameCommand=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.execute=function(t){var e=t.getBody(),i=GameMgr.ins,n=this.facade.retrieveProxy(LevelProxy.NAME);switch(TileObjectPool.getInstance().preCreate(),e){case 0:i.initGame(),e=n.getActionModeVo(),i.gameModel.levelVo=e;break;case 1:i.initGame(),e=n.getTimeModeVo(),i.gameModel.levelVo=e;break;case 2:i.initGame()}this.sendNotification(ApplicationFacade.CHANGE_SCENE,1,UIConfig.SceneADD),this.sendNotification(ApplicationFacade.CHANGE_PANEL,0,UIConfig.PanelADD)},e}(puremvc.SimpleCommand);__reflect(StartNewGameCommand.prototype,"StartNewGameCommand");var StartupCommand=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initializeMacroCommand=function(){this.addSubCommand(ControllerPrepCommand),this.addSubCommand(ModelPrepCommand),this.addSubCommand(ViewPrepCommand)},e}(puremvc.MacroCommand);__reflect(StartupCommand.prototype,"StartupCommand");var SubmitRankCommand=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.execute=function(t){t.getBody(),console.log("submit rank"),this.urlloader=new egret.URLLoader,this.urlloader.dataFormat=egret.URLLoaderDataFormat.VARIABLES;var e=new egret.URLRequest;e.url=URLConst.submitRank,e.method=egret.URLRequestMethod.POST;var i,n=this.facade.retrieveProxy(RankProxy.NAME),o=n.model,a=n.model.localMoveRank;i="name=player&rank="+n.toString(),o.rankLowest=a;var s=new egret.URLVariables(i+"&type=0");e.data=s,this.urlloader.load(e),this.urlloader.addEventListener(egret.Event.COMPLETE,this.onComplete,this)},e.prototype.onComplete=function(t){console.log(t.target.data)},e}(puremvc.SimpleCommand);__reflect(SubmitRankCommand.prototype,"SubmitRankCommand");var ViewPrepCommand=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.execute=function(t){t=t.getBody(),t.addChild(GameMgr.ins.gameScene);var e=new UILayer;t.addChild(e),this.facade.registerMediator(new UIMediator(e))},e}(puremvc.SimpleCommand);__reflect(ViewPrepCommand.prototype,"ViewPrepCommand");var GameAnimationEvent=function(t){function e(e,i,n){return void 0===i&&(i=!1),void 0===n&&(n=!1),t.call(this,e,i,n)||this}return __extends(e,t),e}(egret.Event);GameAnimationEvent.COMPLETE="GameAnimationComplete",__reflect(GameAnimationEvent.prototype,"GameAnimationEvent");var GameStateEvent=function(t){function e(e,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1);var o=t.call(this,e,i,n)||this;return o.linkActionNum=o.clearAllNum=0,o}return __extends(e,t),e}(egret.Event);GameStateEvent.UPDATA="GameStateUpdata",__reflect(GameStateEvent.prototype,"GameStateEvent");var SCENENAME;!function(t){t[t.MainMenu=0]="MainMenu",t[t.GameHUD=1]="GameHUD",t[t.RankList=2]="RankList",t[t.About=3]="About"}(SCENENAME||(SCENENAME={}));var PANELNAME;!function(t){t[t.GameLoading=0]="GameLoading",t[t.Pause=1]="Pause",t[t.GameOver=2]="GameOver",t[t.SubmitRank=3]="SubmitRank"}(PANELNAME||(PANELNAME={}));var UIConfig=function(){function t(){}return t}();UIConfig.SceneADD="add",UIConfig.SceneREMOVE="remove",UIConfig.PanelADD="add",UIConfig.PanelREMOVE="remove",__reflect(UIConfig.prototype,"UIConfig");var URLConst={submitRank:"http://www.windspirit.cn/upload/record.php?openid=12&activity_name=a&game_name=a&record=12",moveRank:"rank.txt",timeRank:"timerank.php"},GameConst=function(){function t(){}return t.getColorRGB=function(t){switch(t){case 5:return 255;case 4:return 65280;case 3:return 16711680;case 1:return 16711935;case 2:return 16776960}return 0},t}();GameConst.MaxColor=5,GameConst.mapWidthTileNum=6,GameConst.mapHeightTileNum=6,GameConst.minClearTileCount=2,__reflect(GameConst.prototype,"GameConst");var GameMapEffect=function(){function t(){}return t.prototype.init=function(t){this.gameMap=t},t.prototype.showJuiceBoom=function(){null==this.juiceBoom&&(this.juiceBoom=new egret.Bitmap,this.juiceBoom.texture=RES.getRes("loading_json.logo")),windspirit.Util.setCenterAnchor(this.juiceBoom),this.juiceBoom.x=this.gameMap.stage.stageWidth/2,this.juiceBoom.y=this.gameMap.stage.stageHeight/2,this.gameMap.addChild(this.juiceBoom),egret.Tween.get(this).wait(50).to({scaleX:1.2,scaleY:1.2},300,egret.Ease.quadIn).call(this.animationDropCompleteCallBack)},t.prototype.animationDropCompleteCallBack=function(){this.gameMap.removeChild(this.juiceBoom)},t.prototype.tileRemoveBoom=function(t,e){var i=RES.getRes("boom_2_json"),n=RES.getRes("boom_2_png"),o=new egret.MovieClipDataFactory(i,n),a=new egret.MovieClip(o.generateMovieClipData());a.rotation=360*Math.random(),this.gameMap.addChild(a),a.x=t,a.y=e,a.frameRate=60,a.play(),a.addEventListener(egret.Event.COMPLETE,this.onBoomComplete,this)},t.prototype.onBoomComplete=function(t){var e=t.target;e.stop(),this.gameMap.removeChild(e)},Object.defineProperty(t,"ins",{get:function(){return null==t._ins&&(t._ins=new t),t._ins},enumerable:!0,configurable:!0}),t}();GameMapEffect._ins=null,__reflect(GameMapEffect.prototype,"GameMapEffect");var GameLogic=function(){function t(){}return t.prototype.timeUpdata=function(){this.settleMgr.timeUpdata()},t.prototype.init=function(){this.gameModel=GameMgr.ins.gameModel,this.gameScene=GameMgr.ins.gameScene,this.settleMgr=new SettleMgr},t.prototype.reset=function(){this.settleMgr=this.gameScene=this.gameModel=null},t.prototype.fillEmpty=function(){for(var t=this.gameModel.mapModel,e=0;e<GameConst.mapWidthTileNum;e++)for(var i=0;i<GameConst.mapHeightTileNum;i++)if(0==t.getTileByPos(e,i).color){var n=this.randomColor();this.addNew(e,i,n)}},t.prototype.addNew=function(t,e,i){var n=this.gameModel.mapModel.getTileByPos(t,e);n.x=t,n.y=e,n.color=i,this.gameScene.mapView.addNewtile(n)},t.prototype.dropDown=function(){for(var t=!1,e=this.gameModel.mapModel,i=0;i<GameConst.mapWidthTileNum;i++)for(var n=GameConst.mapHeightTileNum-1;n>=0;n--){var o=e.getTileByPos(i,n);if(0==o.color)for(var a=n-1;a>=0;){var s=e.getTileByPos(i,a);0!=s.color&&(o.color=s.color,s.color=0,this.fall(s.x,s.y,o.x,o.y),a=-1,t=!0),a--}}return t},t.prototype.canPlay=function(){for(var t=this.gameModel.mapModel,e=0;e<GameConst.mapWidthTileNum;e++)for(var i=0;i<GameConst.mapHeightTileNum;i++){var n=t.getTileByPos(e,i);if(e+1<GameConst.mapWidthTileNum){var o=t.getTileByPos(e+1,i);if(n.color==o.color)return!0}if(i+1<GameConst.mapHeightTileNum&&(o=t.getTileByPos(e,i+1),n.color==o.color))return!0}return!1},t.prototype.fall=function(t,e,i,n){this.gameScene.mapView.fallTile(t,e,n)},t.prototype.clearTile=function(t){var e=this;t.forEach(function(t,i,n){var o=e.gameModel.mapModel.getTileByPos(t.x,t.y);o.color=0,e.gameScene.mapView.clearTile(o,i)}),this.gameModel.stateProxy.addClearAllNum(t.length),this.gameModel.stateProxy.addLinkActionNum(),this.settleMgr.canPlay||GameMgr.ins.pauseGame(),this.gameScene.mapView.addEventListener(GameAnimationEvent.COMPLETE,this.clearTIle2,this)},t.prototype.clearTIle2=function(){this.gameScene.mapView.removeEventListener(GameAnimationEvent.COMPLETE,this.clearTIle2,this),this.dropDown()?this.gameScene.mapView.addEventListener(GameAnimationEvent.COMPLETE,this.clearTIle3,this):this.clearTIle3()},t.prototype.clearTIle3=function(){this.gameScene.mapView.removeEventListener(GameAnimationEvent.COMPLETE,this.clearTIle3,this),this.fillEmpty(),this.gameScene.mapView.addEventListener(GameAnimationEvent.COMPLETE,this.clearTIle4,this)},t.prototype.clearTIle4=function(){this.gameScene.mapView.removeEventListener(GameAnimationEvent.COMPLETE,this.clearTIle4,this),this.canPlay()||this.restartGame(),this.settleMgr.roundOver()},t.prototype.clearAllColor=function(t){for(var e=this.gameModel.mapModel,i=0,n=0;n<GameConst.mapWidthTileNum;n++)for(var o=GameConst.mapHeightTileNum-1;o>=0;o--){var a=e.getTileByPos(n,o);a.color==t&&(a.color=0,this.gameScene.mapView.clearTile(a,i),i++)}this.gameModel.stateProxy.addClearAllNum(i),this.gameModel.stateProxy.addLinkActionNum(),this.settleMgr.canPlay||GameMgr.ins.pauseGame(),this.gameScene.mapView.addEventListener(GameAnimationEvent.COMPLETE,this.clearTIle2,this)},t.prototype.clearAll=function(){for(var t=this.gameModel.mapModel,e=0;e<GameConst.mapWidthTileNum;e++)for(var i=GameConst.mapHeightTileNum-1;i>=0;i--){var n=t.getTileByPos(e,i);n.color=0,this.gameScene.mapView.removeTile(n)}},t.prototype.restartGame=function(){this.clearAll(),this.gameScene.mapView.addEventListener(GameAnimationEvent.COMPLETE,this.restartGame2,this)},t.prototype.restartGame2=function(){this.fillEmpty(),this.gameScene.mapView.removeEventListener(GameAnimationEvent.COMPLETE,this.restartGame2,this)},t.prototype.randomColor=function(){return Math.ceil(Math.random()*GameConst.MaxColor)},t}();__reflect(GameLogic.prototype,"GameLogic");var GameMap=function(t){function e(){var e=t.call(this)||this;return e.tileWidth=0,e.mapTileArray=[],e.resultPoint=new egret.Point,e.touchEnabled=!0,e.touchChildren=!1,e.createMap(),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.gameMapMgr=new GameMapMgr,e.gameMapMgr.init(e),e.gameMapAnimationMgr=GameMapAnimationMgr.ins,e.gameMapAnimationMgr.init(e),e.gameMapEffect=GameMapEffect.ins,e.gameMapEffect.init(e),e}return __extends(e,t),e.prototype.reset=function(){this.mapTileArray.length=0,this.mapTileArray=null,this.gameMapMgr.reset(),this.gameMapMgr=null,this.gameMapAnimationMgr.reset(),this.mapMode=null,this.gameMapAnimationMgr=null,this.removeEventListener(egret.Event.ENTER_FRAME,this.onEF,this),this.removeStageTouchEvent(),this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},e.prototype.getTileByPos=function(t,e){var i=Math.floor(t/this.tileWidth),n=Math.floor(e/this.tileWidth);return this.getTileByColRow(i,n)},e.prototype.getTileByGlobalPos=function(t,e){this.globalToLocal(t,e,this.resultPoint);var i=Math.floor(this.resultPoint.x/this.tileWidth),n=Math.floor(this.resultPoint.y/this.tileWidth);return this.getTileByColRow(i,n)},e.prototype.getTileByColRow=function(t,e){return this.mapTileArray[t]&&this.mapTileArray[t][e]?this.mapTileArray[t][e]:null},e.prototype.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.mapMode=GameMgr.ins.gameModel.mapModel,this.tileWidth=GameViewConst.tileWidth,this.width=this.height=GameViewConst.mapWidth-2*GameViewConst.mapGap,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.addEventListener(egret.Event.ENTER_FRAME,this.onEF,this)},e.prototype.onEF=function(t){this.gameMapMgr.updateEF(),this.gameMapAnimationMgr.updateEF()},e.prototype.onTouchEnd=function(t){this.gameMapMgr.onEnd(),this.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.removeStageTouchEvent()},e.prototype.addStageTouchEvent=function(){this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this)},e.prototype.removeStageTouchEvent=function(){this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this)},e.prototype.onTouchMove=function(t){this.globalToLocal(t.stageX,t.stageY,this.resultPoint);var e=this.getTileByGlobalPos(t.stageX,t.stageY);this.gameMapMgr.onMove(e,this.resultPoint.x,this.resultPoint.y)},e.prototype.onTouchBegin=function(t){if(GameMgr.ins.gameModel.gameState==GameState.start){var e=this.getTileByPos(t.localX,t.localY);e&&(this.gameMapMgr.onBegin(e),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.addStageTouchEvent())}},e.prototype.createMap=function(){for(var t=0;t<GameConst.mapWidthTileNum;t++)this.mapTileArray.push([]);this.mapGridBackGroud=new egret.Bitmap,this.mapGridBackGroud.texture=RES.getRes("tartan_png"),this.lineContainer=new LineContainer,this.addChild(this.lineContainer),this.tileLayer=new egret.DisplayObjectContainer,this.addChild(this.tileLayer),this.lineShape=new egret.Shape,this.addChild(this.lineShape),this.headLineShape=new egret.Shape,this.addChild(this.headLineShape)},e.prototype.addNewtile=function(t){var e=TileObjectPool.getInstance().createObject();e.onInit(t.x,t.y,t.color),this.tileLayer.addChild(e);var i=t.x*this.tileWidth+this.tileWidth/2,n=t.y*this.tileWidth+this.tileWidth/2;e.setX=i,e.setY=n,e.x=i,e.y=n-GameViewConst.mapHeight,this.mapTileArray[t.x][t.y]=e,e.playFall(n,5-t.y,i)},e.prototype.fallTile=function(t,e,i){var n=this.mapTileArray[t][e];this.mapTileArray[t][i]=n,this.mapTileArray[t][e]=null,n.posY=i,i=i*this.tileWidth+this.tileWidth/2,t=t*this.tileWidth+this.tileWidth/2,n.setX=t,n.setY=i,n.playFall(i,5-e,t)},e.prototype.clearTile=function(t,e){var i=this.mapTileArray[t.x][t.y];this.tileLayer.setChildIndex(i,-1),this.mapTileArray[t.x][t.y]=null,i.clearAndRemove(150*Math.sqrt(e))},e.prototype.removeTile=function(t){var e=this.mapTileArray[t.x][t.y];this.mapTileArray[t.x][t.y]=null,null!=e&&e.onlyRemove(t.x+10*t.y)},e}(egret.Sprite);__reflect(GameMap.prototype,"GameMap");var GameState;!function(t){t[t.init=0]="init",t[t.start=1]="start",t[t.pause=2]="pause"}(GameState||(GameState={}));var GameModel=function(){function t(){this.gameState=0,this._mapModel=new MapModel,this._stateProxy=new GameStateProxy,this._stateProxy.setModel(new GameStateModel)}return Object.defineProperty(t.prototype,"mapModel",{get:function(){return this._mapModel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stateProxy",{get:function(){return this._stateProxy},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this._mapModel.reset(),this._mapModel=null,this._stateProxy.reset(),this._stateProxy=null},t}();__reflect(GameModel.prototype,"GameModel");var TileVo=function(){function t(){this.color=0,this.x=0,this.y=0}return t}();__reflect(TileVo.prototype,"TileVo");var MapModel=function(){function t(){this.tileMap=[],this.createMap()}return t.prototype.createMap=function(){for(var t=0;t<GameConst.mapWidthTileNum;t++){for(var e=[],i=0;i<GameConst.mapHeightTileNum;i++){var n=new TileVo;n.color=0,n.x=t,n.y=i,e.push(n)}this.tileMap.push(e)}},t.prototype.getTileByPos=function(t,e){return this.tileMap[t][e]},t.prototype.reset=function(){this.tileMap.length=0,this.tileMap=null},t}();__reflect(MapModel.prototype,"MapModel");var MapTile=function(t){function e(){var e=t.call(this)||this;return e.colorType=0,e.posY=0,e.posX=0,e.staticY=0,e.staticX=0,e._pre2=e._pre1=e._next2=e._next1=null,e._highList=!1,e.touchEnabled=e.touchChildren=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"setX",{set:function(t){this.staticX=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"setY",{set:function(t){this.staticY=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"next",{set:function(t){null==this._next1?this._next1=t:null==this._next2&&null==t?this._next1=t:this._next2=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pre",{set:function(t){null==this._pre1?this._pre1=t:null==this._pre2&&null==t?this._pre1=t:this._pre2=t},enumerable:!0,configurable:!0}),e.prototype.isPre=function(t){return this._pre2?this._pre2==t?!0:!1:this._pre1&&this._pre1==t?!0:!1},e.prototype.isNext=function(t){return this._next2?this._next2==t?!0:!1:this._next1&&this._next1==t?!0:!1},e.prototype.isLink=function(t){return this._next1==t||this._next2==t||this._pre1==t||this._pre2==t?!0:!1},e.prototype.onInit=function(t,e,i){this.posX=t,this.posY=e,this.colorType=i,this.state=0,this.scaleX=this.scaleY=1,this.loadCommonAsset(),windspirit.Util.setCenterAnchor(this),this.highLight=!1},e.prototype.onDestroy=function(){this.reset(),this.parent&&this.parent.removeChild(this)},e.prototype.reset=function(){this._pre2=this._pre1=this._next2=this._next1=null,this.state=0,this.highLight=!1},e.prototype.onCreate=function(){this.view=new egret.Bitmap,this.addChild(this.view),this.anMgr=GameMapAnimationMgr.ins},Object.defineProperty(e.prototype,"state",{set:function(t){switch(t){case 0:this.alpha=1;break;case 1:this.alpha=.5}},enumerable:!0,configurable:!0}),e.prototype.touchSlash=function(t){var i=egret.Tween.get(this);switch(t){case 2:i.to({rotation:-30,x:this.staticX-e.slashMove,scaleX:1.4,scaleY:1.4},120,egret.Ease.sineOut).to({rotation:0,scaleX:1,scaleY:1,x:this.staticX},200,egret.Ease.sineOut);break;case 3:i.to({rotation:30,x:this.staticX+e.slashMove,scaleX:1.4,scaleY:1.4},120,egret.Ease.sineOut).to({rotation:0,scaleX:1,scaleY:1,x:this.staticX},200,egret.Ease.sineOut);break;case 0:i.to({rotation:30,y:this.staticY-e.slashMove,scaleX:1.4,scaleY:1.4},120,egret.Ease.sineOut).to({rotation:0,scaleX:1,scaleY:1,y:this.staticY},200,egret.Ease.sineOut);break;case 1:i.to({rotation:-30,y:this.staticY+e.slashMove,scaleX:1.4,scaleY:1.4},120,egret.Ease.sineOut).to({rotation:0,scaleX:1,scaleY:1,y:this.staticY},200,egret.Ease.sineOut);break;case 4:i.to({scaleX:1.4,scaleY:1.4},120,egret.Ease.sineOut).to({scaleX:1,scaleY:1},200,egret.Ease.sineOut)}},Object.defineProperty(e.prototype,"highLight",{set:function(t){this._highList!=t&&((this._highList=t)?this.view.texture=RES.getRes(GameViewConst.tileHighLight[this.colorType]):this.loadCommonAsset())},enumerable:!0,configurable:!0}),e.prototype.shake=function(){egret.Tween.get(this).wait(100*Math.random()).to({scaleX:1.3,scaleY:.7},100,egret.Ease.sineIn).to({scaleX:.85,scaleY:1.15},95,egret.Ease.sineIn).to({scaleX:1.05,scaleY:.95},90,egret.Ease.sineIn).to({scaleX:.95,scaleY:1.05},85,egret.Ease.sineIn).to({scaleX:1,scaleY:1},80,egret.Ease.sineIn)},e.prototype.loadCommonAsset=function(){this.view.texture=RES.getRes(GameViewConst.tileColor[this.colorType])},e.prototype.playFall=function(t,e,i){this.anMgr.addPlaying(),egret.Tween.get(this).wait(50*e).to({scaleX:1.2,scaleY:1.2,y:t,x:i},300,egret.Ease.quadIn).call(this.animationFallCompleteCallBack)},e.prototype.animationFallCompleteCallBack=function(){this.anMgr.overCount(),egret.Tween.get(this).to({scaleX:1,scaleY:1},80,egret.Ease.sineOut)},e.prototype.clearAndRemove=function(t){void 0===t&&(t=0),this.anMgr.addPlaying(),windspirit.SoundManager.playAudio("clear"),egret.Tween.get(this).wait(t).call(this.removeAnimationWithBoom)},e.prototype.removeAnimationWithBoom=function(){GameMapEffect.ins.tileRemoveBoom(this.x,this.y),egret.Tween.get(this).to({alpha:.8,x:GameViewConst.mapWidth/2-GameViewConst.mapGap,y:-3*GameViewConst.mapGap,scaleX:.3,scaleY:.3},80+60*this.posY,egret.Ease.cubicIn).call(this.removeAnimationCompleteCallBack)},e.prototype.onlyRemove=function(t){this.anMgr.addPlaying(),egret.Tween.get(this).wait(10*t).to({alpha:0,scaleX:0,scaleY:0},300,egret.Ease.circOut).call(this.removeAnimationCompleteCallBack)},e.prototype.removeAnimationCompleteCallBack=function(){this.anMgr.overCount(),TileObjectPool.getInstance().destroyObject(this)},e}(egret.Sprite);MapTile.slashMove=16,__reflect(MapTile.prototype,"MapTile");var Main=function(t){function e(){return t.call(this,{appId:"fruitboom",heart:!1,debug:!1,showLogo:!1})||this}return __extends(e,t),e.prototype.createGameScene=function(){ApplicationFacade.getInstance().startUp(this.gameLayer)},e.prototype.restart=function(){ApplicationFacade.instance.sendNotification(GameCommand.RESTART_GAME)},e}(windspirit.App);__reflect(Main.prototype,"Main");var AboutSceneMediator=function(t){function e(i){var n=t.call(this,e.NAME,i)||this;return RES.isGroupLoaded("guide")?n.setImage():(RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,n.onResourceLoadComplete,n),RES.loadGroup("guide")),n.view.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,n.closeBtnClickHandler,n),n.view.urlLink.addEventListener(egret.TextEvent.LINK,n.urlLinkfunction,n),n.view.txt1.text="可以横着或竖着连接相邻的同类水果，它们将会被消除。\n但不可斜向连接",n.view.txt2.text="连接成封闭形状，将消除全部同类水果。\n比如连接成方形",n}return __extends(e,t),e.prototype.urlLinkfunction=function(t){window.open(t.text,"_blank")},e.prototype.closeBtnClickHandler=function(t){windspirit.Util.safeRemove(this.view)},e.prototype.onResourceLoadComplete=function(t){"guide"==t.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),this.setImage())},e.prototype.setImage=function(){this.view.pic1.texture=RES.getRes("guide_01_jpg"),this.view.pic2.texture=RES.getRes("guide_02_jpg")},e.prototype.onRemove=function(){RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),this.view.urlLink.removeEventListener(egret.TextEvent.LINK,this.urlLinkfunction,this),this.view.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.closeBtnClickHandler,this)},Object.defineProperty(e.prototype,"view",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),e}(puremvc.Mediator);AboutSceneMediator.NAME="AboutSceneMediator",__reflect(AboutSceneMediator.prototype,"AboutSceneMediator");var GameLoadingMediator=function(t){function e(i){var n=t.call(this,e.NAME,i)||this;n.view.startBTN.addEventListener(egret.TouchEvent.TOUCH_TAP,n.startButtonClick,n);var o=0;return n.view.gameTagertTxt.text=o>0?"朋友的分数"+o.toString()+"! 超越它!":"消除最多的水果在"+GameMgr.ins.gameModel.levelVo.action.toString()+"步内!",n}return __extends(e,t),e.prototype.startButtonClick=function(t){this.closethis()},e.prototype.closethis=function(){egret.Tween.get(this.view.container).to({y:this.view.stage.stageHeight},500,egret.Ease.cubicIn).call(this.doClose,this)},e.prototype.doClose=function(){this.sendNotification(GameCommand.PLAY_GAME),windspirit.GameData.isNewer&&(this.view.parent.addChild(new AboutScene),windspirit.GameData.passNewer()),this.view.parent&&this.view.parent.removeChild(this.view)},e.prototype.listNotificationInterests=function(){return[]},e.prototype.handleNotification=function(t){t.getName()},Object.defineProperty(e.prototype,"view",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),e}(puremvc.Mediator);GameLoadingMediator.NAME="GameLoadingMediator",__reflect(GameLoadingMediator.prototype,"GameLoadingMediator");var GameOverMediator=function(t){function e(i){var n=t.call(this,e.NAME,i)||this;return e.ins=n,n.eventAction="",n}return __extends(e,t),e.prototype.restart=function(){this.sendNotification(this.eventAction)},e.prototype.restartButtonClick=function(t){this.eventAction=GameCommand.RESTART_GAME,this.closethis()},e.prototype.quitButtonClick=function(t){this.eventAction=GameCommand.FINISH_GAME,this.closethis()},e.prototype.closethis=function(){egret.Tween.get(this.view).to({x:2*this.view.stage.stageWidth},500,egret.Ease.circOut).call(this.doClose,this)},e.prototype.doClose=function(){this.sendNotification(this.eventAction),this.view.parent&&this.view.parent.removeChild(this.view)},e.prototype.listNotificationInterests=function(){return[]},e.prototype.handleNotification=function(t){t.getName()},Object.defineProperty(e.prototype,"view",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),e}(puremvc.Mediator);GameOverMediator.NAME="GameOverMediator",__reflect(GameOverMediator.prototype,"GameOverMediator");var GameStateBarMediator=function(t){function e(i){var n=t.call(this,e.NAME,i)||this;return n.currentScores=0,n.targetScores=0,n.view.rightBar.menuBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,n.menuButtonClick,n),GameMgr.ins.gameModel.stateProxy.addEventListener(GameStateEvent.UPDATA,n.onGameStateUpdata,n),n.onGameStateUpdata(null),n}return __extends(e,t),e.prototype.menuButtonClick=function(t){this.sendNotification(GameCommand.PAUSE_GAME)},e.prototype.onGameStateUpdata=function(t){this.targetScores=GameMgr.ins.gameModel.stateProxy.getModel().clearAllNum,0==this.targetScores&&(this.view.setScore(0),this.currentScores=0,this.view.setScoresLabelHighlight(!1)),this.view.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.view.leftBar.setValue(GameMgr.ins.gameModel.levelVo.action-GameMgr.ins.gameModel.stateProxy.getModel().linkActionNum),t=egret.Tween.get(this.view.scoresBitmap);var e=this.targetScores-this.currentScores;4>e?t.to({scaleX:1.4,scaleY:1.4},120,egret.Ease.cubicIn).to({scaleX:1,scaleY:1},100,egret.Ease.cubicIn).call(this.removeAnimationCompleteCallBack):6>e?t.to({scaleX:1.5,scaleY:1.5},100,egret.Ease.cubicIn).to({scaleX:1,scaleY:1},80,egret.Ease.cubicIn).to({scaleX:1.4,scaleY:1.4},100,egret.Ease.cubicIn).to({scaleX:1,scaleY:1},80,egret.Ease.cubicIn).call(this.removeAnimationCompleteCallBack):t.to({scaleX:1.6,scaleY:1.5},100,egret.Ease.cubicIn).to({scaleX:1,scaleY:1},80,egret.Ease.cubicIn).to({scaleX:1.4,scaleY:1.4},100,egret.Ease.cubicIn).to({scaleX:1,scaleY:1},80,egret.Ease.cubicIn).to({scaleX:1.3,scaleY:1.3},70,egret.Ease.cubicIn).to({scaleX:1,scaleY:1},80,egret.Ease.cubicIn).call(this.removeAnimationCompleteCallBack)},e.prototype.onEnterFrame=function(t){this.currentScores<this.targetScores?(this.currentScores+=.25,this.view.scoreslabel.text!=Math.floor(this.currentScores).toString()?(this.view.setScore(Math.floor(this.currentScores)),this.view.setScoresLabelHighlight(!1)):this.view.setScoresLabelHighlight(!0)):this.currentScores>this.targetScores?(this.currentScores-=.25,this.view.setScore(Math.floor(this.currentScores))):this.currentScores==this.targetScores&&(this.view.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.view.setScoresLabelHighlight(!1))},e.prototype.removeAnimationCompleteCallBack=function(){},Object.defineProperty(e.prototype,"view",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),e}(puremvc.Mediator);GameStateBarMediator.NAME="GameStateBarMediator",__reflect(GameStateBarMediator.prototype,"GameStateBarMediator");var MainMenuMediator=function(t){function e(i){var n=t.call(this,e.NAME,i)||this;return windspirit.GameAPI.bindApi(windspirit.api.startGame,n.MoveModelButtonClick.bind(n)),n.view.moveBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,n.MoveModelButtonClick,n),n.view.timeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,n.TimeModelButtonClick,n),n.view.listBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,n.ListButtonClick,n),n}return __extends(e,t),e.prototype.onRemoveViewComplete=function(t){switch(t){case 2:this.sendNotification(ApplicationFacade.CHANGE_SCENE,2,UIConfig.SceneADD);
break;case 0:windspirit.GameAPI.gameStart(),ApplicationFacade.instance.sendNotification(GameCommand.START_GAME,0);break;case 1:ApplicationFacade.instance.sendNotification(ApplicationFacade.CHANGE_SCENE,3,UIConfig.SceneADD)}},e.prototype.ListButtonClick=function(t){},e.prototype.MoveModelButtonClick=function(t){this.view.fadeOut(),this.idTimeout=egret.setTimeout(this.onRemoveViewComplete,this,1e3,0)},e.prototype.TimeModelButtonClick=function(t){this.view.fadeOut(),this.idTimeout=egret.setTimeout(this.onRemoveViewComplete,this,1e3,1)},e.prototype.onRemove=function(){egret.clearTimeout(this.idTimeout),this.view.moveBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.MoveModelButtonClick,this),this.view.timeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.TimeModelButtonClick,this),this.view.listBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.ListButtonClick,this)},Object.defineProperty(e.prototype,"view",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),e}(puremvc.Mediator);MainMenuMediator.NAME="MainMenuMediator",__reflect(MainMenuMediator.prototype,"MainMenuMediator");var PauseMenuMediator=function(t){function e(i){var n=t.call(this,e.NAME,i)||this;return n.eventAction="",n.view.resumeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,n.resumeButtonClick,n),n.view.restartButton.addEventListener(egret.TouchEvent.TOUCH_TAP,n.restartButtonClick,n),n.view.quitButton.addEventListener(egret.TouchEvent.TOUCH_TAP,n.quitButtonClick,n),n}return __extends(e,t),e.prototype.resumeButtonClick=function(t){this.eventAction=GameCommand.RESUME_GAME,this.closethis()},e.prototype.restartButtonClick=function(t){this.eventAction=GameCommand.RESTART_GAME,this.closethis()},e.prototype.quitButtonClick=function(t){this.eventAction=GameCommand.FINISH_GAME,this.closethis()},e.prototype.closethis=function(){egret.Tween.get(this.view.container).to({x:2*this.view.stage.stageWidth},500,egret.Ease.circOut).call(this.doClose,this)},e.prototype.doClose=function(){this.sendNotification(this.eventAction),this.view.parent&&this.view.parent.removeChild(this.view)},e.prototype.listNotificationInterests=function(){return[]},e.prototype.handleNotification=function(t){t.getName()},Object.defineProperty(e.prototype,"view",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),e}(puremvc.Mediator);PauseMenuMediator.NAME="PauseMenuMediator",__reflect(PauseMenuMediator.prototype,"PauseMenuMediator");var RankListMediator=function(t){function e(i){var n=t.call(this,e.NAME,i)||this;return n.rankType=0,n.sendNotification(ServiceCommand.GET_RANK,n.rankType),n.view.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,n.closeBtnClickHandler,n),n.refreshRank(),n}return __extends(e,t),e.prototype.listNotificationInterests=function(){return[ServiceCommand.UPDATA_RANK]},e.prototype.handleNotification=function(t){switch(t.getName()){case ServiceCommand.UPDATA_RANK:this.refreshRank()}},e.prototype.closeBtnClickHandler=function(t){this.sendNotification(ApplicationFacade.CHANGE_SCENE,0,UIConfig.SceneADD)},e.prototype.refreshRank=function(){for(var t=this.facade.retrieveProxy(RankProxy.NAME).model.moveRankList,e=t.length,i=0;e>i;i++){var n=t[i],o=this.view.getRender(i);o&&o.setData(n)}},Object.defineProperty(e.prototype,"view",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),e}(puremvc.Mediator);RankListMediator.NAME="RankListMediator",__reflect(RankListMediator.prototype,"RankListMediator");var SubmitRankMediator=function(t){function e(i){var n=t.call(this,e.NAME,i)||this;return n.eventAction="",n}return __extends(e,t),e.prototype.restartButtonClick=function(t){this.eventAction=GameCommand.RESTART_GAME,this.sendNotification(this.eventAction)},e.prototype.quitButtonClick=function(t){this.eventAction=GameCommand.FINISH_GAME,this.closethis()},e.prototype.closethis=function(){egret.Tween.get(this.view.container).to({x:2*this.view.stage.stageWidth},500,egret.Ease.circOut).call(this.doClose,this)},e.prototype.doClose=function(){this.sendNotification(this.eventAction),this.view.parent&&this.view.parent.removeChild(this.view)},e.prototype.listNotificationInterests=function(){return[]},e.prototype.handleNotification=function(t){t.getName()},Object.defineProperty(e.prototype,"view",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),e}(puremvc.Mediator);SubmitRankMediator.NAME="SubmitRankMediator",__reflect(SubmitRankMediator.prototype,"SubmitRankMediator");var UIMediator=function(t){function e(i){return t.call(this,e.NAME,i)||this}return __extends(e,t),e.prototype.listNotificationInterests=function(){return[ApplicationFacade.CHANGE_SCENE,ApplicationFacade.CHANGE_PANEL]},e.prototype.handleNotification=function(t){switch(windspirit.log("handleNotification",t.getName(),t.getBody()),t.getName()){case ApplicationFacade.CHANGE_SCENE:t.getType()==UIConfig.SceneADD?this.openScene(t.getBody()):t.getType()==UIConfig.SceneREMOVE&&this.closeCurrentScene();break;case ApplicationFacade.CHANGE_PANEL:t.getType()==UIConfig.PanelADD?this.addPanel(t.getBody()):t.getType()}},e.prototype.addPanel=function(t){switch(t){case 0:this.view.panelLayer.addChild(new GameLoadingPanel);break;case 1:this.view.panelLayer.addChild(new PauseMenuPanel);break;case 2:this.view.panelLayer.addChild(new GameOverPanel);break;case 3:this.view.panelLayer.addChild(new SubmitRankPanel)}},e.prototype.openScene=function(t){switch(this.closeCurrentScene(),t){case 0:this.currentScene=new MainMenuScene;break;case 1:windspirit.log("start game"),this.currentScene=new GameUIScene;break;case 2:this.currentScene=new RankListScene;break;case 3:windspirit.log("about scene"),this.currentScene=new AboutScene}this.currentScene&&this.view.sceneLayer.addChild(this.currentScene)},e.prototype.closeCurrentScene=function(){this.currentScene&&(this.view.sceneLayer.contains(this.currentScene)&&this.view.sceneLayer.removeChild(this.currentScene),this.currentScene=null)},e.prototype.enterStartGame=function(){},e.prototype.showLeaderBoard=function(){},Object.defineProperty(e.prototype,"view",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),e}(puremvc.Mediator);UIMediator.NAME="UIMediator",__reflect(UIMediator.prototype,"UIMediator");var ControllerPrepCommand=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.execute=function(){(new GameCommand).register(),(new ServiceCommand).register()},e}(puremvc.SimpleCommand);__reflect(ControllerPrepCommand.prototype,"ControllerPrepCommand");var PosPoint=function(){function t(t,e){this.x=0,this.y=0,this.x=t,this.y=e}return t}();__reflect(PosPoint.prototype,"PosPoint");var GameMapMgr=function(){function t(){this.tileList=[],this.reset()}return t.prototype.init=function(t){return this.gameMap=t,this.gameLogic=GameMgr.ins.gameLogic,this},t.prototype.updateEF=function(){this.isStartTouch&&this.drawHead()},t.prototype.reset=function(){for(this.isStartTouch=!1;0<this.tileList.length;)this.tileList.pop().reset();this.currentColor=this.tileList.length=0,this.lastTile=null,this._MouseY=this._MouseX=0,this.gameLogic=this.gameMap=null},t.prototype.onBegin=function(t){if(t){for(;0<this.tileList.length;)this.tileList.pop().reset();this.resetAllTile(),this.tileList=[],this.currentColor=t.colorType,this.hideOtherAll(this.currentColor),this._MouseX=t.x,this._MouseY=t.y,this.add(t),this.gameMap.tileLayer.setChildIndex(t,-1),this.isStartTouch=!0}},t.prototype.onMove=function(t,e,i){this._MouseX=e,this._MouseY=i,t&&1==Math.abs(t.posX-this.lastTile.posX)+Math.abs(t.posY-this.lastTile.posY)&&this.isStartTouch&&t!=this.lastTile&&t.colorType==this.currentColor&&(this.lastTile.isPre(t)?this.remove(this.lastTile):t.isLink(this.lastTile)||(this.add(t),this.gameMap.tileLayer.setChildIndex(t,-1)))},t.prototype.onEnd=function(){this.gameMap.headLineShape.graphics.clear(),this.gameMap.lineShape.graphics.clear(),this.isStartTouch=!1;var t=this.tileList.length;if(this.resetAllTile(),t<GameConst.minClearTileCount)for(;0<this.tileList.length;)this.tileList.pop().reset();else{for(var e=[],i=!1,n=0;t>n;n++){var o=this.tileList[n];if(this.tileList.indexOf(o)<n)i=!0;else{var a=new PosPoint(o.posX,o.posY);e.push(a)}o.pre=null,o.next=null}i?this.gameLogic.clearAllColor(this.tileList[0].colorType):this.gameLogic.clearTile(e),this.tileList=[]}this.lastTile=null},t.prototype.hideOtherAll=function(t){for(var e=0;e<GameConst.mapWidthTileNum;e++)for(var i=0;i<GameConst.mapHeightTileNum;i++){var n=this.gameMap.getTileByColRow(e,i);n&&n.colorType!=t&&(n.state=1)}},t.prototype.resetAllTile=function(){for(var t=0;t<GameConst.mapWidthTileNum;t++)for(var e=0;e<GameConst.mapHeightTileNum;e++){var i=this.gameMap.getTileByColRow(t,e);i&&(i.state=0)}this.gameMap.lineContainer.clearAll()},t.prototype.add=function(t){var e=4;if(0<this.tileList.length){var i=this.tileList[this.tileList.length-1];i.next=t,t.pre=i,i.posY>t.posY?e=0:i.posX<t.posX?e=3:i.posY<t.posY?e=1:i.posX>t.posX&&(e=2),this.gameMap.lineContainer.push(i.staticX,i.staticY,t.staticX,t.staticY,e)}t.highLight=!0,0<=this.tileList.indexOf(t)?(console.log("OOOO"),this.allColorEffect(t.colorType)):t.touchSlash(e),this.tileList.push(t),this.lastTile=t,this.drawLinkCount()},t.prototype.remove=function(t){t.pre=null,this.tileList.pop(),0>this.tileList.indexOf(t)&&(t.highLight=!1),this.isSquare()||this.unAllColorEffect(t.colorType),0<this.tileList.length?(this.lastTile=this.tileList[this.tileList.length-1],this.lastTile.next=null):this.lastTile=null,this.gameMap.lineContainer.pop(),this.drawLinkCount()},t.prototype.drawHead=function(){var t=this.gameMap.headLineShape;t.graphics.clear(),this.lastTile&&(t.graphics.lineStyle(10,16777215,.8,!0,egret.StageScaleMode.NO_SCALE,"round"),t.graphics.moveTo(this.lastTile.staticX,this.lastTile.staticY),t.graphics.lineTo(this._MouseX,this._MouseY),t.graphics.endFill())},t.prototype.drawLinkCount=function(){},t.prototype.allColorEffect=function(t){for(var e=0;e<GameConst.mapWidthTileNum;e++)for(var i=0;i<GameConst.mapHeightTileNum;i++){var n=this.gameMap.getTileByColRow(e,i);n.colorType==t&&(n.highLight=!0,n.shake())}},t.prototype.unAllColorEffect=function(t){for(var e=0;e<GameConst.mapWidthTileNum;e++)for(var i=0;i<GameConst.mapHeightTileNum;i++){var n=this.gameMap.getTileByColRow(e,i);n&&n.colorType==t&&0>this.tileList.indexOf(n)&&(n.highLight=!1)}},t.prototype.isSquare=function(){for(var t=this.tileList.length,e=0;t>e;e++)if(e!=this.tileList.lastIndexOf(this.tileList[e]))return!0;return!1},t.prototype.drawPathLine=function(){var t=this.gameMap.lineShape;t.graphics.clear();var e=GameConst.getColorRGB(this.currentColor);if(t.graphics.lineStyle(5,e,1,!0),1!=this.tileList.length){var i=this.tileList[0];t.graphics.moveTo(i.x,i.y);for(var n=1;n<this.tileList.length;n++){var o=this.tileList[n];t.graphics.lineTo(o.x,o.y)}t.graphics.endFill()}},t}();__reflect(GameMapMgr.prototype,"GameMapMgr");var GameMgr=function(){function t(){this.createGameScene()}return t.prototype.initGame=function(){this.createGameModel(),this.createGameLogic(),this._gameLogic.init(),this._gameScene.init()},t.prototype.reset=function(){this._gameModel.reset(),this._gameModel=null,this._gameLogic.reset(),this._gameLogic=null,this._gameScene.reset()},t.prototype.startNewGame=function(){this._gameLogic.fillEmpty(),this._gameModel.stateProxy.init(),this._gameModel.gameState=GameState.start},t.prototype.restartGame=function(){this._gameLogic.restartGame(),this._gameModel.stateProxy.init(),this._gameModel.gameState=GameState.start},t.prototype.pauseGame=function(){this._gameModel.gameState=GameState.pause},t.prototype.resumeGame=function(){this._gameModel.gameState=GameState.start},t.prototype.timerFunc=function(){this._gameModel.stateProxy.addTimes(),this._gameLogic.timeUpdata()},t.prototype.createGameScene=function(){this._gameScene=new GameScene},Object.defineProperty(t.prototype,"gameModel",{get:function(){return this._gameModel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gameLogic",{get:function(){return this._gameLogic},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gameScene",{get:function(){return this._gameScene},enumerable:!0,configurable:!0}),t.prototype.createGameModel=function(){return this._gameModel=new GameModel},t.prototype.createGameLogic=function(){this._gameLogic=new GameLogic},Object.defineProperty(t,"ins",{get:function(){return null==t._ins&&(t._ins=new t),t._ins},enumerable:!0,configurable:!0}),t}();GameMgr._ins=null,__reflect(GameMgr.prototype,"GameMgr");var SettleMgr=function(){function t(){this.gameModel=GameMgr.ins.gameModel}return t.prototype.startGame=function(){},t.prototype.roundOver=function(){var t=this.gameModel.levelVo,e=this.gameModel.stateProxy.getModel();0<t.action&&e.linkActionNum>=t.action&&this.gameOver()},Object.defineProperty(t.prototype,"canPlay",{get:function(){var t=this.gameModel.levelVo,e=this.gameModel.stateProxy.getModel();return 0<t.action&&e.linkActionNum>=t.action?!1:!0},enumerable:!0,configurable:!0}),t.prototype.timeUpdata=function(){var t=this.gameModel.levelVo,e=this.gameModel.stateProxy.getModel();0<t.time&&e.gameTime>=t.time&&this.gameOver()},t.prototype.gameOver=function(){ApplicationFacade.getInstance().sendNotification(GameCommand.OVER_GAME)},t}();__reflect(SettleMgr.prototype,"SettleMgr");var TileObjectPool=function(){function t(){this.initCount=36,this._pool=[],this._list=[]}return t.prototype.createObject=function(){var t;return t=this._pool,null!=t&&t.length?t=t.shift():(t=new MapTile,t.onCreate()),this._list.push(t),t},t.prototype.destroyObject=function(t){-1==this._pool.indexOf(t)&&this._pool.push(t),t.onDestroy(),t=this._list.indexOf(t),-1!=t&&this._list.splice(t,1)},t.prototype.destroyAllObject=function(){for(;this._list.length;)this.destroyObject(this._list[0])},t.prototype.preCreate=function(){for(;this._pool.length<this.initCount;){var t=new MapTile;t.onCreate(),this._pool.push(t)}},t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t}();TileObjectPool.instance=null,__reflect(TileObjectPool.prototype,"TileObjectPool");var GameStateModel=function(){function t(){this.gameTime=0,this.linkActionNum=0,this.clearAllNum=0}return t}();__reflect(GameStateModel.prototype,"GameStateModel");var RankListVo=function(){function t(){this.nickName="",this.rank=0,this.date="",this.isLocal=!1}return t}();__reflect(RankListVo.prototype,"RankListVo");var RankModel=function(){function t(){this.localMoveRank=0,this.rankLowest=0,this.moveRankList=[],this.timeRankList=[],this.rawMoveRankList=[]}return t}();__reflect(RankModel.prototype,"RankModel");var GameStateProxy=function(t){function e(e){return void 0===e&&(e=null),t.call(this,e)||this}return __extends(e,t),e.prototype.setModel=function(t){this._model=t},e.prototype.getModel=function(){return this._model},e.prototype.addClearAllNum=function(t){return void 0===t&&(t=1),this._model.clearAllNum+=t,this.disPatchEventGameState(),this._model.clearAllNum},e.prototype.addLinkActionNum=function(t){return void 0===t&&(t=1),this._model.linkActionNum+=t,this.disPatchEventGameState(),this._model.linkActionNum},e.prototype.addTimes=function(t){return void 0===t&&(t=1),this._model.gameTime+=t,this.disPatchEventGameState(),this._model.gameTime},e.prototype.init=function(){this._model.clearAllNum=0,this._model.linkActionNum=0,this._model.gameTime=0,this.disPatchEventGameState()},e.prototype.reset=function(){this._model.clearAllNum=0,this._model.linkActionNum=0,this._model.gameTime=0,this._event=this._model=null},e.prototype.disPatchEventGameState=function(){null==this._event&&(this._event=new GameStateEvent(GameStateEvent.UPDATA)),this.dispatchEvent(this._event)},e}(egret.EventDispatcher);__reflect(GameStateProxy.prototype,"GameStateProxy");var LevelVo=function(){function t(){this.time=0,this.action=0,this.gameType=0}return t}();__reflect(LevelVo.prototype,"LevelVo");var LevelProxy=function(t){function e(){var i=t.call(this,e.NAME)||this;return i.levelJson=RES.getRes("gameLevel_json"),i}return __extends(e,t),e.prototype.getActionModeVo=function(){var t=new LevelVo;return t.gameType=0,t.action=this.levelJson.moveMode.action,t.time=this.levelJson.moveMode.time,t},e.prototype.getTimeModeVo=function(){var t=new LevelVo;return t.gameType=1,t.action=this.levelJson.timeMode.action,t.time=this.levelJson.timeMode.time,t},e}(puremvc.Proxy);LevelProxy.NAME="LevelProxy",__reflect(LevelProxy.prototype,"LevelProxy");var RankProxy=function(t){function e(){var i=t.call(this,e.NAME)||this;return i.setData(new RankModel),i}return __extends(e,t),Object.defineProperty(e.prototype,"model",{get:function(){return this.getData()},enumerable:!0,configurable:!0}),e}(puremvc.Proxy);RankProxy.NAME="RankProxy",__reflect(RankProxy.prototype,"RankProxy");var CButtonData=function(){function t(){this.normalAsset="",this.overAsset="",this.label="",this.iconAsset=""}return t}();__reflect(CButtonData.prototype,"CButtonData");var CButton=function(t){function e(e){var i=t.call(this)||this;i._cdata=e,i.bg=new egret.Bitmap,i.addChild(i.bg);var n=RES.getRes("font_fnt");return i.textField=new egret.BitmapText,i.textField.font=n,windspirit.Util.setCenterAnchor(i.textField),i.addChild(i.textField),i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,i.onTouchBegin,i),i.addEventListener(egret.TouchEvent.TOUCH_END,i.onTouchEnd,i),i.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,i.onTouchEnd,i),i.init(),i}return __extends(e,t),e.createLabel=function(t){var e=new egret.TextField;return e.size=35,e.text=t,e.bold=!0,e.fontFamily="微软雅黑",e.textColor=5271830,windspirit.Util.setCenterAnchor(e),e.x=159,e.y=39,e},e.prototype.init=function(){this.overState(!1),this.textField.text=this._cdata.label,this.textField.y=this.bg.height/2-5,this.textField.x=this.bg.width/2,0<this._cdata.iconAsset.length&&(this.icon=new egret.Bitmap,this.icon.texture=RES.getRes(this._cdata.iconAsset),this.icon.anchorOffsetY=this.icon.height>>1,this.icon.y=this.bg.height/2,this.icon.x=this.icon.width/2,this.addChild(this.icon))},e.prototype.overState=function(t){this.bg.texture=t?RES.getRes(this._cdata.overAsset):RES.getRes(this._cdata.normalAsset)},e.prototype.onTouchBegin=function(t){this.overState(!0)},e.prototype.onTouchEnd=function(t){this.overState(!1)},e}(egret.DisplayObjectContainer);__reflect(CButton.prototype,"CButton");var GameStateBar=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.leftBar=new LeftTopStateBar,this.leftBar.alpha=0,this.addChild(this.leftBar),this.rightBar=new RightTopStateBar,this.rightBar.alpha=0,this.addChild(this.rightBar),this.rightBar.x=this.stage.stageWidth-this.rightBar.width,this.stateContainer=new egret.DisplayObjectContainer,this.stateContainer.width=this.stage.stageWidth,this.addChild(this.stateContainer),this.scoresBitmap=new egret.Bitmap,this.scoresBitmap.texture=RES.getRes("score_icon_png"),windspirit.Util.setCenterAnchor(this.scoresBitmap),this.scoresBitmap.x=this.stateContainer.width/2,this.scoresBitmap.y=30,this.goldFont=RES.getRes("fontGold_fnt"),this.whiteFont=RES.getRes("fontWhiteNumber_fnt"),this.scoreslabel=new egret.BitmapText,this.scoreslabel.font=this.goldFont,this.scoreslabel.y=50,this.scoreslabel.x=this.stateContainer.width/2,this.setScore(0),this.stateContainer.addChild(this.scoreslabel),this.stateContainer.addChild(this.scoresBitmap),ApplicationFacade.getInstance().registerMediator(new GameStateBarMediator(this)),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this.fadeIn()},e.prototype.setScore=function(t){this.scoreslabel.text=t.toString(),this.scoreslabel.anchorOffsetX=this.scoreslabel.width>>1},e.prototype.fadeIn=function(){this.leftBar.y=-this.leftBar.height,egret.Tween.get(this.leftBar).to({y:0,alpha:1},1e3,egret.Ease.cubicInOut),this.rightBar.y=-this.rightBar.height,egret.Tween.get(this.rightBar).to({y:0,alpha:1},1e3,egret.Ease.cubicInOut),this.stateContainer.y=-this.stateContainer.height,egret.Tween.get(this.stateContainer).to({y:0,alpha:1},1200,egret.Ease.cubicInOut)},e.prototype.setScoresLabelHighlight=function(t){this.scoreslabel.font=t?this.whiteFont:this.goldFont},e.prototype.onRemove=function(t){ApplicationFacade.getInstance().removeMediator(GameStateBarMediator.NAME)},e}(egret.DisplayObjectContainer);__reflect(GameStateBar.prototype,"GameStateBar");var GameViewConst=function(){function t(){}return t}();GameViewConst.tileColor="none dot_img_01a dot_img_02a dot_img_03a dot_img_04a dot_img_05a".split(" "),GameViewConst.tileHighLight="none dot_img_01b dot_img_02b dot_img_03b dot_img_04b dot_img_05b".split(" "),GameViewConst.lineAssetName="link",GameViewConst.mapWidth=480,GameViewConst.mapHeight=480,GameViewConst.tileWidth=64,GameViewConst.tileHeight=64,GameViewConst.mapGap=48,GameViewConst.mapMarginTop=150,GameViewConst.stateBarHeight=68,GameViewConst.mapbackGroudColor=6593182,__reflect(GameViewConst.prototype,"GameViewConst");var IconButton=function(t){function e(e){var i=t.call(this)||this;return i._cdata=e,i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i}return __extends(e,t),e.prototype.onAddToStage=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.init()},e.prototype.init=function(){this.icon=new egret.Bitmap,this.addChild(this.icon),this.overState(!1),0<this._cdata.label.length&&(this.textField=new egret.TextField,this.textField.textAlign="center",this.textField.anchorOffsetX=this.textField.width>>1,this.addChild(this.textField),this.textField.width=120,this.textField.y=this.icon.height,this.textField.text=this._cdata.label)},e.prototype.overState=function(t){this.icon.texture=t?RES.getRes(this._cdata.overAsset):RES.getRes(this._cdata.normalAsset)},e.prototype.onTouchBegin=function(t){this.overState(!0)},e.prototype.onTouchEnd=function(t){this.overState(!1)},e}(egret.DisplayObjectContainer);__reflect(IconButton.prototype,"IconButton");var LeftTopStateBar=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.bg=new egret.Bitmap,this.bg.texture=RES.getRes("image_01_png"),this.addChild(this.bg);var t=RES.getRes("fontGold_fnt");this.typeLabel=CButton.createLabel("剩余步数"),this.typeLabel.size=25,this.typeLabel.x=this.bg.width/2+5,this.typeLabel.y=30,this.typeLabel.textColor=12299636,this.addChild(this.typeLabel),this.valueLabel=new egret.BitmapText,this.valueLabel.font=t,this.valueLabel.y=this.bg.height/2-5,this.valueLabel.x=this.bg.width/2-20,this.valueLabel.anchorOffsetX=this.valueLabel.width>>1,this.addChild(this.valueLabel),this.setValue(0)},e.prototype.setValue=function(t){this.valueLabel.text=t.toString(),this.valueLabel.anchorOffsetX=this.valueLabel.width>>1},e}(egret.DisplayObjectContainer);__reflect(LeftTopStateBar.prototype,"LeftTopStateBar");var LineContainer=function(t){function e(){var e=t.call(this)||this;return e.lineList=[],e.poolList=[],e}return __extends(e,t),e.prototype.init=function(){},e.prototype.push=function(t,e,i,n,o){var a;a=0<this.poolList.length?this.poolList.pop():new egret.Bitmap,this.lineList.push(a),this.addChild(a),a.x=(t+i)/2,a.y=(e+n)/2,a.rotation=1==o||0==o?0:90,a.texture=RES.getRes(GameViewConst.lineAssetName),windspirit.Util.setCenterAnchor(a)},e.prototype.pop=function(){var t;t=this.lineList.pop(),this.removeChild(t),this.poolList.push(t)},e.prototype.clearAll=function(){for(;this.lineList.length;)this.pop()},e}(egret.DisplayObjectContainer);__reflect(LineContainer.prototype,"LineContainer");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.b_slash=e.b_complete=!1,e.n_percent=0,e.cup_run=!1,e.cup_r=3*Math.PI/2,e.cup_center=new egret.Point,e.cup_half=0,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.showLoading()},e.prototype.onLoadingViewComplete=function(t){this.removeChild(this.preSlash),this.showLoading()},e.prototype.showLoading=function(){this.logo=new windspirit.Bitmap("logo"),this.logo.anchorOffsetX=this.logo.width>>1,this.logo.x=this.stage.stageWidth/2,this.logo.alpha=0,this.addChild(this.logo),egret.Tween.get(this.logo).to({y:this.stage.stageWidth/2-this.logo.width/2,alpha:1},1e3,egret.Ease.cubicInOut).wait(1200).call(this.fadeInComplete,this),this.loadProgress=new LoadProgressCup,this.loadProgress.x=this.stage.stageWidth/2,this.loadProgress.y=this.stage.stageHeight,this.loadProgress.alpha=0,this.addChild(this.loadProgress),egret.Tween.get(this.loadProgress).to({y:this.stage.stageWidth,alpha:1},1e3,egret.Ease.circInOut).call(this.playCupRun,this),this.cup_half=60,this.cup_center.x=this.stage.stageWidth/2,this.cup_center.y=this.stage.stageWidth+this.cup_half,this.addEventListener(egret.Event.ENTER_FRAME,this.onEF,this)},e.prototype.setProgress=function(t,e){this.n_percent=t/e},e.prototype.fadeInComplete=function(){this.b_slash=!0},e.prototype.playCup=function(){this.cup_run&&!this.b_complete&&(this.cup_r+=.02,this.loadProgress.x=this.cup_center.x+Math.cos(this.cup_r)*this.cup_half,this.loadProgress.y=this.cup_center.y+Math.sin(this.cup_r)*this.cup_half)},e.prototype.playCupRun=function(){this.cup_run=!0},e.prototype.onEF=function(t){this.b_complete&&this.b_slash?(egret.Tween.removeTweens(this.loadProgress),this.removeEventListener(egret.Event.ENTER_FRAME,this.onEF,this),egret.Tween.get(this.logo).to({y:10,alpha:1},800,egret.Ease.cubicOut).call(this.completeRemove,this),egret.Tween.get(this.loadProgress).to({y:this.stage.stageHeight,alpha:0},600,egret.Ease.cubicIn)):(this.loadProgress.setPercent(this.n_percent),this.playCup())},e.prototype.remove=function(){this.b_complete=!0},e.prototype.completeRemove=function(){egret.Tween.removeTweens(this.loadProgress),egret.Tween.removeTweens(this.logo),console.log("completeRemove"),this.dispatchEvent(new egret.Event(egret.Event.COMPLETE))},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var LoadProgressCup=function(t){function e(){var e=t.call(this)||this;return e.currentP=0,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this);var t=new windspirit.Bitmap("loading_02");windspirit.Util.setCenterAnchor(t),this.addChild(t),this.juice=new windspirit.Bitmap("loading_01"),windspirit.Util.setCenterAnchor(this.juice),this.juice.y=-14,this.addChild(this.juice),this.juice.scaleX=this.juice.scaleY=0,this.textField=new egret.TextField,this.addChild(this.textField),this.textField.width=t.width,this.textField.height=100,this.textField.textAlign="center",windspirit.Util.setCenterAnchor(this.textField),this.textField.y=20,this.textField.text="0"},e.prototype.setPercent=function(t){this.currentP+=(t-this.currentP)/3,this.textField.text=Math.floor(100*this.currentP).toString()+"%",this.juice.scaleX=this.juice.scaleY=this.currentP,this.juice.alpha=this.currentP},e}(egret.DisplayObjectContainer);__reflect(LoadProgressCup.prototype,"LoadProgressCup");var LogoSlash=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.bg=new egret.Bitmap,this.bg.texture=RES.getRes("bg_black"),this.bg.fillMode=egret.BitmapFillMode.REPEAT,this.bg.width=this.stage.stageWidth,this.bg.height=this.stage.stageHeight,this.addChild(this.bg);var e=RES.getRes("slimemould_json"),i=RES.getRes("slimemould_png"),n=new egret.MovieClipDataFactory(e,i);this.mc=new egret.MovieClip(n.generateMovieClipData()),this.addChild(this.mc),this.mc.anchorOffsetX=this.mc.width,this.mc.anchorOffsetY=this.mc.height,this.mc.y=this.stage.stageHeight/2,this.mc.x=this.stage.stageWidth/2-100,this.mc.play(),this.logoTxt=new egret.Bitmap,this.logoTxt.texture=RES.getRes("SlimeMouldsText"),this.logoTxt.anchorOffsetY=this.logoTxt.height,this.logoTxt.alpha=0,this.logoTxt.y=this.stage.stageHeight/2+30,this.logoTxt.x=this.stage.stageWidth/2-100,this.addChild(this.logoTxt),egret.Tween.get(this.logoTxt).wait(1e3).to({y:this.stage.stageHeight/2,alpha:1},800,egret.Ease.cubicInOut),this.mc.addEventListener(egret.Event.COMPLETE,this.onComplete,this)},e.prototype.onComplete=function(t){this.mc.stop(),egret.Tween.get(this).to({alpha:0},200,egret.Ease.cubicIn).call(this.removeAnimationCompleteCallBack)},e.prototype.removeAnimationCompleteCallBack=function(){this.dispatchEvent(new egret.Event(egret.Event.COMPLETE))},e}(egret.DisplayObjectContainer);__reflect(LogoSlash.prototype,"LogoSlash");var ApplicationFacade=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.prototype.initializeController=function(){t.prototype.initializeController.call(this),this.registerCommand(e.STARTUP,StartupCommand)},e.prototype.startUp=function(t){this.sendNotification(e.STARTUP,t),this.removeCommand(e.STARTUP),this.sendNotification(e.CHANGE_SCENE,0,UIConfig.SceneADD)},e}(puremvc.Facade);ApplicationFacade.instance=null,ApplicationFacade.STARTUP="start_up",ApplicationFacade.CHANGE_SCENE="change_scene",ApplicationFacade.CHANGE_PANEL="change_panel",ApplicationFacade.CLICK_SHARE="click_share",__reflect(ApplicationFacade.prototype,"ApplicationFacade");var GameLoadingPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){this.container=new egret.DisplayObjectContainer,this.addChild(this.container),this.bg=new egret.Bitmap,this.bg.texture=RES.getRes("image_02_png"),this.bg.width=540,this.bg.height=220,this.container.addChild(this.bg);var t=new CButtonData;t.normalAsset="btn_a_png",t.overAsset="btn_b_png",this.startBTN=new CButton(t),windspirit.Util.setCenterAnchor(this.startBTN),this.startBTN.x=this.bg.width/2,this.startBTN.y=3*this.bg.height/4,this.startBTN.addChild(CButton.createLabel("开始")),this.container.addChild(this.startBTN),this.gameTagertTxt=new egret.TextField,this.gameTagertTxt.textAlign="center",this.gameTagertTxt.width=360,windspirit.Util.setCenterAnchor(this.gameTagertTxt),this.gameTagertTxt.stroke=2,this.gameTagertTxt.strokeColor=0,this.gameTagertTxt.x=this.bg.width/2,this.gameTagertTxt.y=this.bg.height/4,this.container.addChild(this.gameTagertTxt),this.container.y=-this.stage.stageHeight/2,this.container.x=this.stage.stageWidth/2,ApplicationFacade.getInstance().registerMediator(new GameLoadingMediator(this)),this.mediatorName=PauseMenuMediator.NAME,this.fadeIn(),this.shadowBg(!0),windspirit.Util.setCenterAnchor(this.container)},e.prototype.fadeIn=function(){egret.Tween.get(this.container).to({x:this.stage.stageWidth/2,y:this.stage.stageHeight/2},1e3,egret.Ease.cubicInOut)},e}(BasePanel);__reflect(GameLoadingPanel.prototype,"GameLoadingPanel");var GameOverPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){windspirit.GameData.score=GameMgr.ins.gameModel.stateProxy.getModel().clearAllNum;var t=new windspirit.GameOverLayer;this.container.addChild(t)},e.prototype.fadeIn=function(){},e}(BasePanel);__reflect(GameOverPanel.prototype,"GameOverPanel");var PauseMenuPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){this.container=new egret.DisplayObjectContainer,this.addChild(this.container),this.bg=new egret.Bitmap,this.bg.texture=RES.getRes("image_02_png"),this.bg.width=420,this.bg.height=180,this.container.addChild(this.bg);
var t=new windspirit.Bitmap("help");t.anchorOffsetX=t.width>>1,t.x=this.bg.width/5,t.y=this.bg.height>>1,t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.helpClick,this),this.container.addChild(t);var e=new CButtonData;e.normalAsset="btn_icon_04a_png",e.overAsset="btn_icon_04b_png",this.resumeButton=new IconButton(e),windspirit.Util.setCenterAnchor(this.resumeButton),this.resumeButton.x=2*this.bg.width/5,this.resumeButton.y=this.bg.height/2,this.container.addChild(this.resumeButton),e=new CButtonData,e.normalAsset="btn_icon_05a_png",e.overAsset="btn_icon_05b_png",this.restartButton=new IconButton(e),windspirit.Util.setCenterAnchor(this.restartButton),this.restartButton.x=3*this.bg.width/5,this.restartButton.y=this.bg.height/2,this.container.addChild(this.restartButton),e=new CButtonData,e.normalAsset="btn_icon_06a_png",e.overAsset="btn_icon_06b_png",this.quitButton=new IconButton(e),windspirit.Util.setCenterAnchor(this.quitButton),this.quitButton.x=4*this.bg.width/5,this.quitButton.y=this.bg.height/2,this.container.addChild(this.quitButton),this.container.y=windspirit.Util.centerY,this.shadowBg(!0),ApplicationFacade.getInstance().registerMediator(new PauseMenuMediator(this)),this.mediatorName=PauseMenuMediator.NAME,windspirit.Util.setCenterAnchor(this.container),this.fadeIn()},e.prototype.helpClick=function(){this.parent.addChild(new AboutScene)},e.prototype.fadeIn=function(){egret.Tween.get(this.container).to({x:windspirit.Util.centerX,y:windspirit.Util.centerY},800,egret.Ease.backOut)},e}(BasePanel);__reflect(PauseMenuPanel.prototype,"PauseMenuPanel");var SubmitRankPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){windspirit.GameData.score=GameMgr.ins.gameModel.stateProxy.getModel().clearAllNum,windspirit.Net.uploadScore(),ApplicationFacade.getInstance().registerMediator(new SubmitRankMediator(this)),this.mediatorName=SubmitRankMediator.NAME},e.prototype.fadeIn=function(){egret.Tween.get(this.container).to({x:windspirit.Util.centerX,y:windspirit.Util.centerY},800,egret.Ease.backOut)},e}(BasePanel);__reflect(SubmitRankPanel.prototype,"SubmitRankPanel");var RankListRenders=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.nickName=new egret.TextField,this.nickName.textColor=16777215,this.nickName.width=200,this.nickName.x=100,this.nickName.y=40,this.nickName.textAlign=egret.HorizontalAlign.LEFT,this.addChild(this.nickName),t=RES.getRes("fontGold_fnt"),this.rankScores=new egret.BitmapText,this.rankScores.font=t,this.rankScores.y=30,this.rankScores.x=2*this.stage.stageWidth/3,this.addChild(this.rankScores),this.nickName.text="---",this.rankScores.text="000"},e.prototype.setData=function(t){this.nickName.text=t.nickName,this.rankScores.text=t.rank.toString(),this.nickName.textColor=t.isLocal?16777215:12299636},e}(egret.DisplayObjectContainer);__reflect(RankListRenders.prototype,"RankListRenders");var RightTopStateBar=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.bg=new egret.Bitmap,this.bg.texture=RES.getRes("image_01_png"),this.bg.scaleX=-1,this.bg.anchorOffsetX=this.bg.width,this.addChild(this.bg);var t=new CButtonData;t.normalAsset="btn_01a_png",t.overAsset="btn_01b_png",this.menuBtn=new IconButton(t),windspirit.Util.setCenterAnchor(this.menuBtn),this.menuBtn.x=this.bg.width/2,this.menuBtn.y=this.bg.height/2-35,this.addChild(this.menuBtn)},e}(egret.DisplayObjectContainer);__reflect(RightTopStateBar.prototype,"RightTopStateBar");var AboutScene=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.pic1=new egret.Bitmap,e.pic2=new egret.Bitmap,e.pic2.y=240,e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.addChild(this.pic1),this.addChild(this.pic2),this.txt1=new egret.TextField,this.txt1.textColor=10606033,this.txt1.width=190,this.txt1.size=24,this.txt1.x=250,this.txt1.y=70,this.txt1.textAlign=egret.HorizontalAlign.LEFT,this.addChild(this.txt1),this.txt1.bold=!0,this.txt2=new egret.TextField,this.txt2.textColor=10606033,this.txt2.width=190,this.txt2.size=24,this.txt2.x=55,this.txt2.y=280,this.txt2.textAlign=egret.HorizontalAlign.LEFT,this.addChild(this.txt2),this.txt2.bold=!0,t=new CButtonData,t.normalAsset="btn_a_png",t.overAsset="btn_b_png",this.closeBtn=new CButton(t),this.closeBtn.addChild(CButton.createLabel("朕知道了")),this.closeBtn.anchorOffsetX=this.closeBtn.width>>1,this.closeBtn.x=this.stage.stageWidth/2,this.closeBtn.y=500,this.addChild(this.closeBtn),this.urlLink=new egret.TextField,this.urlLink.width=this.stage.stageWidth,this.urlLink.textFlow=Array({text:"www.windspirit.cn",style:{href:"event:http://www.windspirit.cn/",size:24,textColor:15856113}}),this.urlLink.touchEnabled=!0,this.urlLink.strokeColor=0,this.urlLink.stroke=2,this.urlLink.x=140,this.urlLink.y=540,ApplicationFacade.getInstance().registerMediator(new AboutSceneMediator(this)),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)},e.prototype.addLogo=function(){if(640<this.stage.stageHeight){var t=RES.getRes("slimemould_json"),e=RES.getRes("slimemould_png"),i=new egret.MovieClipDataFactory(t,e);this.mc=new egret.MovieClip(i.generateMovieClipData()),this.addChild(this.mc),this.mc.anchorOffsetX=this.mc.width,this.mc.anchorOffsetY=this.mc.height,this.mc.y=640,this.mc.x=windspirit.Util.centerX-100,this.mc.play(),this.logoTxt=new egret.Bitmap,this.logoTxt.texture=RES.getRes("loading_json.SlimeMouldsText"),this.logoTxt.anchorOffsetY=this.logoTxt.height,this.logoTxt.alpha=0,this.logoTxt.y=680,this.logoTxt.x=windspirit.Util.centerX-100,this.addChild(this.logoTxt),egret.Tween.get(this.logoTxt).wait(1e3).to({y:640,alpha:1},800,egret.Ease.cubicInOut)}},e.prototype.onRemove=function(t){ApplicationFacade.getInstance().removeMediator(AboutSceneMediator.NAME)},e}(BaseScene);__reflect(AboutScene.prototype,"AboutScene");var GameCommand=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.register=function(){this.facade.registerCommand(e.START_GAME,StartNewGameCommand),this.facade.registerCommand(e.OVER_GAME,GameOverCommand),this.facade.registerCommand(e.PAUSE_GAME,GamePauseCommand),this.facade.registerCommand(e.FINISH_GAME,GameFinishCommand),this.facade.registerCommand(e.PLAY_GAME,e),this.facade.registerCommand(e.UPDATE_SCORE,e),this.facade.registerCommand(e.RESTART_GAME,e),this.facade.registerCommand(e.RESUME_GAME,e)},e.prototype.execute=function(t){switch(t.getBody(),t.getName()){case e.RESTART_GAME:GameMgr.ins.restartGame();break;case e.PLAY_GAME:GameMgr.ins.startNewGame();break;case e.RESUME_GAME:GameMgr.ins.resumeGame()}},e}(puremvc.SimpleCommand);GameCommand.NAME="GameCommand",GameCommand.START_GAME="start_game",GameCommand.FINISH_GAME="finish_game",GameCommand.RESTART_GAME="restart_game",GameCommand.UPDATE_SCORE="update_score",GameCommand.OVER_GAME="over_game",GameCommand.PLAY_GAME="play_game",GameCommand.PAUSE_GAME="pause_game",GameCommand.RESUME_GAME="resume_game",__reflect(GameCommand.prototype,"GameCommand");var GameScene=function(t){function e(){var e=t.call(this)||this,i=new windspirit.Bitmap("bg_01_jpg");return i.width=windspirit.Util.stageW,i.height=windspirit.Util.stageH,i.fillMode=egret.BitmapFillMode.REPEAT,e.addChild(i),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){},e.prototype.init=function(){null==this.highlightBg&&(this.highlightBg=new egret.Bitmap,this.addChild(this.highlightBg),this.highlightBg.texture=RES.getRes("bg_02_png"),this.highlightBg.alpha=0),null==this.gameMapBg&&(this.gameMapBg=new egret.Bitmap,this.addChild(this.gameMapBg),this.gameMapBg.texture=RES.getRes("bg_03_png"),this.gameMapBg.y=GameViewConst.stateBarHeight+GameViewConst.mapMarginTop,this.gameMapBg.x=GameViewConst.mapGap,this.gameMapBg.alpha=0),null==this.gameMap&&(this.gameMap=new GameMap),this.addChild(this.gameMap),this.gameMap.y=this.gameMapBg.y,this.gameMap.x=this.gameMapBg.x,this.fadeIn()},e.prototype.fadeIn=function(){egret.Tween.get(this.highlightBg).to({alpha:1},1e3,egret.Ease.cubicOut),egret.Tween.get(this.gameMapBg).wait(1e3).to({alpha:1},1e3,egret.Ease.cubicOut)},Object.defineProperty(e.prototype,"mapView",{get:function(){return this.gameMap},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.gameMap.reset(),this.removeChild(this.gameMap),this.gameMap=null,this.removeChild(this.gameMapBg),this.gameMapBg=null},e}(egret.DisplayObjectContainer);__reflect(GameScene.prototype,"GameScene");var GameUIScene=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.gameStateBar=new GameStateBar,this.addChild(this.gameStateBar)},e}(BaseScene);__reflect(GameUIScene.prototype,"GameUIScene");var MainMenuScene=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){var e=new windspirit.Bitmap("start_bg");e.width=windspirit.Util.stageW,e.height=windspirit.Util.stageH,e.fillMode=egret.BitmapFillMode.SCALE,this.addChild(e),this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.logo=new egret.Bitmap,this.logo.texture=RES.getRes("logo"),this.logo.anchorOffsetX=this.logo.width>>1,this.logo.alpha=1,this.logo.x=windspirit.Util.centerX,this.logo.y=100,this.addChild(this.logo),t=new CButtonData,t.normalAsset="btn_a_png",t.overAsset="btn_b_png",t.iconAsset="btn_icon_01a_png",this.moveBtn=new windspirit.Bitmap("btn_start"),this.moveBtn.touchEnabled=!0,this.moveBtn.width=318,this.moveBtn.height=78,this.moveBtn.anchorOffsetX=this.moveBtn.width>>1,this.moveBtn.x=this.stage.stageWidth/2,this.moveBtn.y=509,this.addChild(this.moveBtn),t=new CButtonData,t.normalAsset="btn_a_png",t.overAsset="btn_b_png",t.iconAsset="btn_icon_03a_png",this.listBtn=new CButton(t),this.listBtn.anchorOffsetX=this.listBtn.width>>1,this.listBtn.x=this.moveBtn.x,this.listBtn.y=this.moveBtn.y+80,this.listBtn.addChild(CButton.createLabel("排行榜")),t=new CButtonData,t.normalAsset="btn_a_png",t.overAsset="btn_b_png",t.iconAsset="btn_icon_07a_png",this.timeBtn=new CButton(t),this.timeBtn.addChild(CButton.createLabel("游戏规则")),this.timeBtn.anchorOffsetX=this.timeBtn.width>>1,this.timeBtn.x=this.moveBtn.x,this.timeBtn.y=this.listBtn.y+80,ApplicationFacade.getInstance().registerMediator(new MainMenuMediator(this)),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this.fadeIn()},e.prototype.fadeIn=function(){this.btnListFadeIn(this.moveBtn,0),this.btnListFadeIn(this.listBtn,200),this.btnListFadeIn(this.timeBtn,400)},e.prototype.fadeOut=function(){this.btnListFadeOut(this.moveBtn,0),this.btnListFadeOut(this.listBtn,200),this.btnListFadeOut(this.timeBtn,400),egret.Tween.get(this.logo).to({x:0,alpha:0},800,egret.Ease.cubicIn)},e.prototype.btnListFadeIn=function(t,e){var i=egret.Tween.get(t),n=t.y;t.y=this.stage.stageHeight,t.alpha=0,i.wait(e).to({y:n,alpha:1},800,egret.Ease.cubicOut)},e.prototype.btnListFadeOut=function(t,e){egret.Tween.get(t).wait(e).to({x:0,alpha:0},300,egret.Ease.cubicIn)},e.prototype.onRemove=function(t){ApplicationFacade.getInstance().removeMediator(MainMenuMediator.NAME)},e}(BaseScene);__reflect(MainMenuScene.prototype,"MainMenuScene");var RankListScene=function(t){function e(){var e=t.call(this)||this;return e.renderList=[],e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.initList(),ApplicationFacade.getInstance().registerMediator(new RankListMediator(this)),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)},e.prototype.initList=function(){this.bg=new egret.Bitmap,this.bg.texture=RES.getRes("image_02_png"),this.bg.width=460,this.bg.height=500,this.bg.x=10,this.bg.y=5,this.addChild(this.bg);for(var t=0;6>t;t++){var e=new RankListRenders;if(this.renderList.push(e),this.addChild(e),e.x=10,e.y=80*t,5>t){var i=new egret.Bitmap;i.texture=RES.getRes("line_png"),this.addChild(i),i.y=80*(t+1)+5,i.anchorOffsetX=i.width>>1,i.x=this.stage.stageWidth/2}}var n=new CButtonData;n.normalAsset="btn_a_png",n.overAsset="btn_b_png",this.closeBtn=new CButton(n),this.closeBtn.addChild(CButton.createLabel("返回")),this.closeBtn.anchorOffsetX=this.closeBtn.width>>1,this.closeBtn.x=this.stage.stageWidth/2,this.closeBtn.y=this.bg.height+10,this.addChild(this.closeBtn)},e.prototype.getRender=function(t){return this.renderList.length>t?this.renderList[t]:null},e.prototype.onRemove=function(t){ApplicationFacade.getInstance().removeMediator(RankListMediator.NAME)},e}(BaseScene);__reflect(RankListScene.prototype,"RankListScene");var UILayer=function(t){function e(){var e=t.call(this)||this;return e.init(),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)},e.prototype.init=function(){this.sceneLayer=new egret.DisplayObjectContainer,this.addChild(this.sceneLayer),this.panelLayer=new egret.DisplayObjectContainer,this.addChild(this.panelLayer)},e}(egret.DisplayObjectContainer);__reflect(UILayer.prototype,"UILayer");