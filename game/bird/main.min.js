var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},FruitNodeType;!function(t){t[t.kFruitTypeGreen=0]="kFruitTypeGreen",t[t.kFruitTypeRed=1]="kFruitTypeRed",t[t.kFruitTypeBig=2]="kFruitTypeBig",t[t.kFruitTypeMax=3]="kFruitTypeMax"}(FruitNodeType||(FruitNodeType={}));var GameObjectType;!function(t){t[t.kGameObjectNone=0]="kGameObjectNone",t[t.kBirdType=1]="kBirdType",t[t.kPlatformType=2]="kPlatformType",t[t.kFruitType=3]="kFruitType",t[t.kCatType=4]="kCatType",t[t.kStarType=5]="kStarType",t[t.kGasoilType=6]="kGasoilType",t[t.kPotionType=7]="kPotionType",t[t.kMagnetType=8]="kMagnetType",t[t.kRushType=9]="kRushType",t[t.kWingType=10]="kWingType",t[t.kTransformType=11]="kTransformType",t[t.kSheildType=12]="kSheildType",t[t.kFlagType=13]="kFlagType",t[t.kBoxType=14]="kBoxType"}(GameObjectType||(GameObjectType={}));var GameObject=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.collisionWithOther=function(t){switch(this.m_objectType){case GameObjectType.kPlatformType:return!1;case GameObjectType.kFruitType:return!0;case GameObjectType.kStarType:return windspirit.Util.safeRemove(this),!0;case GameObjectType.kPotionType:return!0;case GameObjectType.kFlagType:return!0;case GameObjectType.kSheildType:return!0;case GameObjectType.kCatType:return!0}},e.prototype.updateWithDeltaTime=function(t,e){},e.prototype.getName=function(){switch(this.m_objectType){case GameObjectType.kPlatformType:return"platform";case GameObjectType.kFruitType:return"fruit";case GameObjectType.kStarType:return"star";case GameObjectType.kPotionType:return"potion";case GameObjectType.kFlagType:return"flag";case GameObjectType.kSheildType:return"sheild"}},e.prototype.setObjectType=function(t){this.m_objectType=t},e.prototype.getObjectType=function(){return this.m_objectType},e.prototype.isIgnore=function(){return this.m_isIgnoreCollision},e.prototype.ignore=function(t){this.m_isIgnoreCollision=t},e.prototype.checkNodeRemoval=function(t){return this.localToGlobal().x+this.width<=0?(windspirit.log("remove(%s)",this.getName()),windspirit.Util.safeRemove(this),!0):!1},e}(egret.Sprite);__reflect(GameObject.prototype,"GameObject");var MagnetNode=function(t){function e(){var e=t.call(this)||this;return e.setObjectType(GameObjectType.kMagnetType),e.addChild(new egret.Bitmap(RES.getRes("ShopBuyEndRun_png"))),e}return __extends(e,t),e}(GameObject);__reflect(MagnetNode.prototype,"MagnetNode");var FlagNode=function(t){function e(){var e=t.call(this)||this;return e.setObjectType(GameObjectType.kFlagType),e.addChild(new egret.Bitmap(RES.getRes("ShopBuyEndRun_png"))),e}return __extends(e,t),e}(GameObject);__reflect(FlagNode.prototype,"FlagNode");var s_fruit_name=["item-fruit-green_png","item-fruit-red_png","item-fruit-big_png"],FruitNode=function(t){function e(e){var i=t.call(this)||this;return i.setObjectType(GameObjectType.kFruitType),i.m_fruitType=e,i.addChild(new windspirit.Bitmap(s_fruit_name[e])),i}return __extends(e,t),e.prototype.getFruitType=function(){return this.m_fruitType},e.prototype.changeFruitType=function(){this.m_fruitType=FruitNodeType.kFruitTypeRed,this.bmp=new egret.Bitmap(RES.getRes(""))},e.prototype.collisionWithOther=function(t){this.removeChildren();var e=Util.createParticle("fx_eat_fruit","fx_eat_fruit_json");return this.addChild(e),!0},e}(GameObject);__reflect(FruitNode.prototype,"FruitNode");var GAME_CHAIN_SCORE=100,ObjData=function(){function t(){}return t}();__reflect(ObjData.prototype,"ObjData");var GameLayer=function(t){function e(){var e=t.call(this)||this;e.m_stageNLength=0,e.m_layoutGameObjects=[],e.m_layoutLoopGameObjects=[],e.m_layoutTutorial=[],e.m_stageTutorialLen=0,e.m_collisionNodes=[],e.m_stageLength=0,e.m_count=0,e.m_loopStageCount=0,e.m_layoutTutorialLoop=[],e.m_trackSpeed=0,e.bgConfig={bgFar:70,bgMiddle:150,bgObject:380,bgNear:300,bgForeground:420,bgCloud:50,distanceTempo:600,speedupInc:.15,triggerBoxDistance1:1013,triggerBoxDistance2:1990,triggerBoxDistance3:2560,triggerBoxDistance4:3460},e.m_buyPropSlots=0,e.m_speedFactor=0,e.m_distanceTempoCnt=0,e.m_isFirstSoaring=!1,e.m_preSpeed=0,e.m_isLastSoaring=!1,e.skinName="GameLayerSkin";var i=new egret.Shape;return i.graphics.beginGradientFill(egret.GradientType.LINEAR,[2330490,14080991],[1,1],[0,255]),i.graphics.drawRect(0,0,windspirit.Util.stageW,windspirit.Util.stageH),e.m_backgroundNode.addChild(i),windspirit.GameData.isNewer?(e.initNormalStage(),e.initLoopStage()):e.initGuideStage(),egret.Ticker.getInstance().register(e.updateGame,e),Player.getInstance().setGameState(GameState.kGameStatePrepare),e.startGamePlaying(),e}return __extends(e,t),e.prototype.createBackgroundNode=function(){this.generateBackgroundByType(0)},e.prototype.startGamePlaying=function(){this.initNewcomer(),Player.getInstance().initResult(),this.createBackgroundNode(),Player.getInstance().getGameState()==GameState.kGameStatePrepare&&(egret.Tween.get(this.m_foregroundNode).to({scaleX:FOREGROUND_SCALE_FACTOR,scaleY:FOREGROUND_SCALE_FACTOR},2e3),Player.getInstance().setGameState(GameState.kGameStatePlaying),this.m_foregroundNode.removeChildren(),this.m_player=this.createPlayer(),this.m_player.setScaleFactor(FOREGROUND_SCALE_FACTOR),this.m_player.setGamePlaying(!0,s_bg_points_per_sec[BG_POINTS_PER_SEC_TYPE.FOREGROUND_POINTS_PER_SEC]),this.m_foregroundNode.addChild(this.m_player),this.createHudLayer(this.m_player),this.speedTo(1),this.m_collisionNodes=[],this.playGameMusic()),windspirit.GameData.isNewer&&this.applyProps()},e.prototype.playGameMusic=function(){},e.prototype.applyProps=function(){this.setProp(GamePropSlotType.kPropSlotFirstSoar),this.setProp(GamePropSlotType.kPropSlotEndSoar)},e.prototype.setProp=function(t){this.m_buyPropSlots|=t},e.prototype.removeProp=function(t){this.m_buyPropSlots&=~t},e.prototype.didStopChain=function(t){var e=t*GAME_CHAIN_SCORE;this.m_hudNode.stopChain(e),Player.getInstance().tmpAwardScore+=e,Player.getInstance().addPerformance(e)},e.prototype.endFly=function(){this.removeProp(GamePropSlotType.kPropSlotEndSoar),Player.getInstance().setGameState(GameState.kGameStatePlaying),this.m_player.y=480,this.m_player.x=this.m_foregroundNode.globalToLocal(PLAYER_START_POSITION_X).x,this.m_player.soar(8),this.m_isLastSoaring=!0},e.prototype.speedTo=function(t){this.m_speedFactor=t,this.m_player.speedTo(t)},e.prototype.createHudLayer=function(t){this.m_hudNode=new HudLayer(t,this),this.addChild(this.m_hudNode)},e.prototype.createPlayer=function(){var t=new Bird(this);return t.x=PLAYER_START_POSITION_X,t.y=PLAYER_START_POSITION_Y,t},e.prototype.initNewcomer=function(){},e.prototype.updateViewPoint=function(t){this.setViewPointX()},e.prototype.updateHP=function(t){this.m_hudNode.updateStaminaBar(t)},e.prototype.bounceHP=function(t){this.m_hudNode.bounceStaminaBar(t)},e.prototype.didWarning=function(t){t?this.m_hudNode.addWarningAction():this.m_hudNode.removeWarning()},e.prototype.didContact=function(t,e){if(null!=e){for(var i=0;i<this.m_collisionNodes.length;i++)if(this.m_collisionNodes[i]==e){this.m_collisionNodes.splice(i,1);break}var a=e.getObjectType();switch(a){case GameObjectType.kCatType:Player.getInstance().addPerformance(GAME_DASH_CAT_SCORE),Player.getInstance().tmpDashCatNum++;break;case GameObjectType.kStarType:Player.getInstance().addPerformance(GAME_OBJECT_STAR_SCORE);break;case GameObjectType.kFruitType:var r=0,o=e.getFruitType();if(o==FruitNodeType.kFruitTypeGreen){var n=1;this.isPropUse(GamePropSlotType.kPropSlotFruitBoost)&&(n=2*n),Player.getInstance().tmpFruitNum+=n,r+=GAME_OBJECT_FRUIT_SCORE}else if(o==FruitNodeType.kFruitTypeRed){var n=2;this.isPropUse(GamePropSlotType.kPropSlotFruitBoost)&&(n=2*n),Player.getInstance().tmpFruitNum+=n,r+=2*GAME_OBJECT_FRUIT_SCORE}else if(o==FruitNodeType.kFruitTypeBig){var n=10;this.isPropUse(GamePropSlotType.kPropSlotFruitBoost)&&(n=2*n),Player.getInstance().tmpFruitNum+=n,r+=10*GAME_OBJECT_FRUIT_SCORE}this.m_hudNode.changeFruitNum(Player.getInstance().tmpFruitNum),Player.getInstance().addPerformance(r);break;case GameObjectType.kPlatformType:}}},e.prototype.collisionPropsOut=function(t){var e=new egret.Point(800,200),i=new egret.Point(800,5),a=new egret.Point(800,-200),r=windspirit.Util.randClose(0,100);if(40>r&&!windspirit.GameData.isNewer){var o=null,n=windspirit.Util.randClose(0,100),s=-1;switch(s=n>=0&&12>n?GAME_OBJECT_NAME_TYPE.GAME_OBJECT_WING_TYPE:n>=.12&&40>n?GAME_OBJECT_NAME_TYPE.GAME_OBJECT_RUSH_TYPE:n>=.4&&.7>n?GAME_OBJECT_NAME_TYPE.GAME_OBJECT_MAGNET_TYPE:GAME_OBJECT_NAME_TYPE.GAME_OBJECT_TRANSFORM_TYPE){case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_MAGNET_TYPE:o=new MagnetNode;break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_RUSH_TYPE:this.m_player.isBufferOn(BirdBufferType.kBirdBufferSoaring)||(o=new RushNode);break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_TRANSFORM_TYPE:o=new TransformNode;break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_WING_TYPE:this.m_player.isBufferOn(BirdBufferType.kBirdBufferRushing)||(o=new WingNode)}null!=o&&(o.x=t.x,o.y=t.y,o.ignore(!0),this.m_foregroundNode.addChild(o),this.m_collisionNodes.push(o))}else this.addFruitCollisionOut(FruitNodeType.kFruitTypeRed,t,e);this.addFruitCollisionOut(FruitNodeType.kFruitTypeGreen,t,i),this.addFruitCollisionOut(FruitNodeType.kFruitTypeRed,t,a)},e.prototype.addFruitCollisionOut=function(t,e,i){var a=new FruitNode(t);a.x=e.x,a.y=e.y,a.ignore(!0),this.m_foregroundNode.addChild(a),this.m_collisionNodes.push(a)},e.prototype.didGameOver=function(){},e.prototype.didUpdateChain=function(t){this.m_hudNode.updateChain(t)},e.prototype.setViewPointX=function(){if(Player.getInstance().getGameState()==GameState.kGameStatePlaying){var t=(this.m_player.x-PLAYER_START_POSITION_X)*FOREGROUND_SCALE_FACTOR- -this.m_foregroundNode.x;if(t>.5&&100>=t)this.m_trackSpeed=2;else if(t>100&&350>=t)this.m_trackSpeed=2.5;else if(t>350)this.m_trackSpeed=7;else if(this.m_trackSpeed>1){this.m_trackSpeed=1;var e=this.m_player.localToGlobal(),i=this.m_foregroundNode.globalToLocal(e.x,e.y);this.m_player.x=i.x,this.m_player.y=i.y}}},e.prototype.checkCatJumpOutSchedule=function(t){},e.prototype.checkGameobjectRemovalSchedule=function(t){if(Player.getInstance().getGameState()!=GameState.kGameStatePrepare)for(var e=0;e<this.m_collisionNodes.length;e++)this.m_collisionNodes[e]&&this.m_collisionNodes[e].checkNodeRemoval(this.m_player.x)&&(this.m_collisionNodes.splice(e,1),e--);for(var i=[],e=0;e<this.m_foregroundNode.numChildren;e++){var a=this.m_foregroundNode.getChildAt(e);a.localToGlobal().x<=-a.width&&a!=this.m_player&&i.push(a)}for(var e in i)this.m_foregroundNode.removeChild(i[e])},e.prototype.updateDistanceSchedule=function(t){if(Player.getInstance().getGameState()!=GameState.kGameStatePrepare){var e=this.m_player.x,i=e>>6;this.m_hudNode.changeDistanceNum(i);var a=i-Player.getInstance().tmpDistance;a>0&&Player.getInstance().addPerformance(a*GAME_DISTANCE_SCORE),Player.getInstance().tmpDistance=i,this.m_hudNode.changePerformanceNum(Player.getInstance().tmpPerformanceNum),this.triggerFirstFly(i),this.switchBackgroundByMeters(i)}},e.prototype.switchBackgroundByMeters=function(t){var e=Math.floor(t/this.bgConfig.distanceTempo);e>this.m_distanceTempoCnt&&(this.m_distanceTempoCnt++,this.m_speedFactor<2&&this.speedByFactor(this.bgConfig.speedupInc))},e.prototype.updateGame=function(t){this.updateDistanceSchedule(t),this.checkGameobjectRemovalSchedule(t),this.checkCatJumpOutSchedule(t);var e=Player.getInstance().getGameState();if(e!=GameState.kGameStatePause&&e!=GameState.kGameStateOver&&e!=GameState.kGameStatePrepare){if(t>20&&(t=20),this.m_player.y>windspirit.Util.stageH+200)return Player.getInstance().setGameState(GameState.kGameStateOver),void this.endGame();e!=GameState.kGameStateOver&&e!=GameState.kGameStatePause&&e!=GameState.kGameStatePreOver&&(this.setViewPointX(),this.moveBg(t)),this.m_player.updateWithDeltaTime(t,this.m_collisionNodes),this.setViewPointY(this.m_player.y),windspirit.GameData.isNewer?this.addGameObjectsToForeground(this.m_foregroundNode.x,this.m_layoutGameObjects,this.m_stageLength,this.m_layoutLoopGameObjects):this.addGameObjectsToForeground(this.m_foregroundNode.x,this.m_layoutTutorial,this.m_stageTutorialLen,this.m_layoutTutorialLoop),this.m_foregroundNode.setChildIndex(this.m_player,this.m_foregroundNode.numChildren-1),windspirit.GameData.isNewer&&this.checkTutorial()}},e.prototype.checkTutorial=function(){},e.prototype.addGameObjectsToForeground=function(t,e,i,a){if(0!=this.m_count){if(t<=-windspirit.Util.stageW*(this.m_count-1)){if(this.m_count<e.length)this.addScreenObjectsToMapByIndex(e,this.m_count);else{var r=Math.ceil(this.m_stageNLength/windspirit.Util.stageW),o=Math.ceil(i/windspirit.Util.stageW)*windspirit.Util.stageW,n=windspirit.Util.stageW*r*(this.m_loopStageCount/r);n+=o,this.addScreenObjectsToMapByIndex(a,this.m_loopStageCount%r,n/FOREGROUND_SCALE_FACTOR),this.m_loopStageCount++}this.m_count++}}else{this.m_count=2;for(var s=0;s<this.m_count;s++)this.addScreenObjectsToMapByIndex(e,s)}},e.prototype.addScreenObjectsToMapByIndex=function(t,e,i){if(void 0===i&&(i=0),!(e>=t.length)){var a=t[e];for(var r in a)this.createMapNode(a[r].type,a[r].x/FOREGROUND_SCALE_FACTOR+i,a[r].y/FOREGROUND_SCALE_FACTOR)}},e.prototype.createMapNode=function(t,e,i){if(null!=t){for(var a=-1,r=0;r<GAME_OBJECT_NAME_TYPE.GAME_OBJECT_MAX;r++){var o=s_game_object_name_type[r];if(t==o){a=r;break}}switch(a){case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_PLATFORM_TYPE_1:this.createPlatformByPosition(PlatformNodeType.kPlatformTypeTMX1,e,i);break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_PLATFORM_TYPE_2:this.createPlatformByPosition(PlatformNodeType.kPlatformTypeTMX2,e,i);break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_PLATFORM_TYPE_3:this.createPlatformByPosition(PlatformNodeType.kPlatformTypeTMX3,e,i);break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_PLATFORM_TYPE_4:this.createPlatformByPosition(PlatformNodeType.kPlatformTypeTMX4,e,i);break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_PLATFORM_TYPE_5:this.createPlatformByPosition(PlatformNodeType.kPlatformTypeTMX5,e,i);break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_PLATFORM_TYPE_6:this.createPlatformByPosition(PlatformNodeType.kPlatformTypeTMX6,e,i);break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_PLATFORM_TYPE_7:this.createPlatformByPosition(PlatformNodeType.kPlatformTypeTMX7,e,i);break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_PLATFORM_TYPE_8:this.createPlatformByPosition(PlatformNodeType.kPlatformTypeTMX8,e,i);break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_PLATFORM_TYPE_9:this.createPlatformByPosition(PlatformNodeType.kPlatformTypeTMX9,e,i);break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_PLATFORM_TYPE_10:this.createPlatformByPosition(PlatformNodeType.kPlatformTypeTMX10,e,i);break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_FRUIT_GREEN_TYPE:this.createFruitByPosition(FruitNodeType.kFruitTypeGreen,e,i);break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_FRUIT_RED_TYPE:this.createFruitByPosition(FruitNodeType.kFruitTypeRed,e,i);break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_FRUIT_BIG_TYPE:this.createFruitByPosition(FruitNodeType.kFruitTypeBig,e,i);break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_CAT_FLY_TYPE:this.createCatByPosition(CatNodeType.kCatNodeFly,e,i);break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_CAT_GROUND_TYPE:this.createCatByPosition(CatNodeType.kCatNodeGround,e,i);break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_STAR_TYPE:this.createStarByPosition(e,i);break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_GASOIL_TYPE:this.createGasoilByPosition(e,i);break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_POTION_NORMAL_TYPE:this.createPotionByPosition(PotionNodeType.kPotionNodeNormal,e,i);break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_POTION_BIG_TYPE:this.createPotionByPosition(PotionNodeType.kPotionNodeBig,e,i);break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_MAGNET_TYPE:this.createMagnetByPosition(e,i);break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_RUSH_TYPE:this.createRushByPosition(e,i);break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_SHEILD_TYPE:this.createSheildByPosition(e,i);break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_TRANSFORM_TYPE:this.createTransformByPosition(e,i);break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_WING_TYPE:this.createWingByPosition(e,i);break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_FLAG_TYPE:this.createFlagByPosition(e,i);break;case GAME_OBJECT_NAME_TYPE.GAME_OBJECT_BOX_TYPE:}}},e.prototype.triggerFirstFly=function(t){t>=15&&this.isPropUse(GamePropSlotType.kPropSlotFirstSoar)&&(this.removeProp(GamePropSlotType.kPropSlotFirstSoar),this.m_player.soar(8),this.m_isFirstSoaring=!0)},e.prototype.changeSpeed=function(t){this.m_preSpeed=this.m_speedFactor,this.speedByFactor(t)},e.prototype.speedByFactor=function(t){this.m_speedFactor+=t,this.m_player.speedTo(this.m_speedFactor)},e.prototype.pauseGame=function(){egret.Ticker.getInstance().unregister(this.updateGame,this)},e.prototype.resumeSpeed=function(){this.speedTo(this.m_preSpeed)},e.prototype.didEndSoaring=function(){this.m_isFirstSoaring&&(this.m_isFirstSoaring=!1),this.m_isLastSoaring&&(this.m_isLastSoaring=!1,this.m_player.dead())},e.prototype.setViewPointY=function(t){if(Player.getInstance().getGameState()==GameState.kGameStatePlaying){var e=windspirit.Util.centerY-200;t=Math.min(t,e),t=Math.max(t,-1040);var i=e-t;0!=i&&(i*=FOREGROUND_SCALE_FACTOR,this.m_foregroundNode.y=i,this.m_farGround.y=.42*i,this.m_midGround.y=.43*i,this.m_nearGround.y=.88*i,this.m_objGround.y=i,this.m_cloudGround.y=.1*i)}},e.prototype.endGame=function(){if(this.isPropUse(GamePropSlotType.kPropSlotEndSoar))this.endFly();else{var t=new GameOverLayer;this.addChild(t)}},e.prototype.backHome=function(){egret.Ticker.getInstance().unregister(this.updateGame,this),Main.ins.createGameScene()},e.prototype.isPropUse=function(t){return 0!=(this.m_buyPropSlots&t)},e.prototype.resumeButtonPressed=function(){egret.Ticker.getInstance().register(this.updateGame,this)},e.prototype.moveBg=function(t){t/=1e3;var e=-s_bg_points_per_sec[BG_POINTS_PER_SEC_TYPE.FOREGROUND_POINTS_PER_SEC]*this.m_speedFactor*this.m_trackSpeed,i=e*t;this.m_foregroundNode.x+=i,this.move_bg_dt(this.m_farGround,-this.bgConfig.bgFar*this.m_speedFactor*this.m_trackSpeed*t),this.move_bg_dt(this.m_midGround,-this.bgConfig.bgMiddle*this.m_speedFactor*this.m_trackSpeed*t),this.move_bg_dt(this.m_nearGround,-this.bgConfig.bgNear*this.m_speedFactor*this.m_trackSpeed*t),this.move_bg_dt(this.m_objGround,-this.bgConfig.bgObject*this.m_speedFactor*this.m_trackSpeed*t),this.move_bg_dt(this.m_cloudGround,-this.bgConfig.bgCloud*this.m_speedFactor*this.m_trackSpeed*t)},e.prototype.move_bg_dt=function(t,e){for(var i=0;i<t.numChildren;i++){var a=t.getChildAt(i);a.x+=e,a.x<=-a.width&&(a.x+=2*a.width)}},e.prototype.generateBackgroundByType=function(t){this.createFarGround(),this.createMidGround(),this.createNearGround(),this.createObjectGroundNode("forest_object",3,1,0),this.createCloudGroundNode("bg_cloud",3,0,0)},e.prototype.createFarGround=function(){this.addDoubleNode("forest_far",7,1,1,640,"",this.m_farGround)},e.prototype.createMidGround=function(){this.addDoubleNode("forest_mid",11,1,1,640,"",this.m_midGround)},e.prototype.createNearGround=function(){this.addDoubleNode("forest_near",7,1,1,640,"",this.m_nearGround)},e.prototype.createCloudGroundNode=function(t,e,i,a){for(var r=0;2>r;r++){var o=new egret.DisplayObjectContainer;o.x=windspirit.Util.stageW*r,o.y=a,this.generateCloudsNode(t,e,o),o.width=windspirit.Util.stageW,o.height=windspirit.Util.stageH,this.m_cloudGround.addChild(o)}},e.prototype.generateCloudsNode=function(t,e,i){for(var a=[-20,-10,0,10,20,40,50],r=[-80,-200,-100,-150,-130,-50,-30],o=[1,1,.65,.7,.8,.9],n=windspirit.Util.stageW/e,s=0;e>s;s++){var _=windspirit.Util.randBigOpen(0,r.length),d=windspirit.Util.randBigOpen(0,a.length),p=windspirit.Util.randBigOpen(0,o.length),h=windspirit.Util.stageH-r[_],m=a[d],l=o[p],c=windspirit.Util.randBigOpen(0,5),u=t+"_"+windspirit.Util.zfill(c+1,2),y=new egret.Bitmap(RES.getRes(u)),T=y.height;y.x=n*s+m,y.y=windspirit.Util.stageH-T+h,y.scaleX=y.scaleY=l,y.alpha=.5,i.addChild(y)}},e.prototype.createObjectGroundNode=function(t,e,i,a){for(var r=0;2>r;r++){var o=new egret.DisplayObjectContainer;o.x=windspirit.Util.stageW*r,o.y=a,this.generateObjectBgToNode(t,e,o),o.width=windspirit.Util.stageW,o.height=windspirit.Util.stageH,this.m_objGround.addChild(o)}},e.prototype.generateObjectBgToNode=function(t,e,i){for(var a=[0,0,-5,-10,-20,-30,-40],r=[1,1,.6,.7,.8,.9],o=windspirit.Util.stageW/e,n=0;e>n;n++){var s=windspirit.Util.randBigOpen(0,e),_=windspirit.Util.randBigOpen(0,a.length),d=windspirit.Util.stageH-a[_],p=windspirit.Util.randBigOpen(0,r.length),h=r[p],m=t+"_"+windspirit.Util.zfill(s+1,2),l=new egret.Bitmap(RES.getRes(m));l.anchorOffsetY=l.height,l.x=o*n,l.y=d,l.scaleX=l.scaleY=h,i.addChild(l)}},e.prototype.addDoubleNode=function(t,e,i,a,r,o,n){for(var s=0;2>s;s++){var _=this.jointNode(t,e,o);_.x=s*_.width,_.y=r,n.addChild(_)}},e.prototype.jointNode=function(t,e,i){for(var a=new egret.DisplayObjectContainer,r=0,o=0,n=0;e>n;n++){var s=t+"_"+windspirit.Util.zfill(n+1,2),_=new egret.Bitmap(RES.getRes(s));_.anchorOffsetY=_.height,_.x=r,r+=_.width,o=Math.max(o,_.height),a.addChild(_)}return r=0==r?windspirit.Util.stageW:r,o=0==o?windspirit.Util.stageH:o,a.width=r,a.height=o,a},e.prototype.createMapFromJson=function(t){var e=RES.getRes(t),i=0,a=[],r=1;for(var o in e){var n=[],s=RES.getRes(e[o]);for(var _ in s){var d=new ObjData;d.id=s[_].id,d.x=s[_].x,d.y=s[_].y,d.type=s[_].type,n.push(d)}var p=0;for(var h in n){var m=n[h],l=Math.floor(m.x*FOREGROUND_SCALE_FACTOR);m.y=windspirit.Util.stageH-Math.floor(m.y*FOREGROUND_SCALE_FACTOR),m.x=l,m.x+=Math.floor(i);var c=FOREGROUND_SCALE_FACTOR*OBJ_WIDTH[m.type];l+c>p&&(p=l+c),a.push(m),r++}i+=p}a.sort(function(t,e){return t.x-e.x});var u=1,y=[],T=[];for(var o in a)a[o].x<windspirit.Util.stageW*u?T.push(a[o]):(u++,y.push(T),T=[],T.push(a[o]));return y.push(T),y},e.prototype.initNormalStage=function(){this.m_layoutGameObjects.length||(this.m_layoutGameObjects=this.createMapFromJson("stage1"),this.m_stageLength=this.getStageLength(this.m_layoutGameObjects))},e.prototype.initLoopStage=function(){this.m_layoutLoopGameObjects.length||(this.m_layoutLoopGameObjects=this.createMapFromJson("stageN"),this.m_stageNLength=this.getStageLength(this.m_layoutLoopGameObjects))},e.prototype.initGuideStage=function(){this.m_layoutTutorial=this.createMapFromJson("stage0"),this.m_stageTutorialLen=this.getStageLength(this.m_layoutTutorial)},e.prototype.getStageLength=function(t){var e=0,i=0,a=t[t.length-1];for(var r in a){var o=a[r];i=OBJ_WIDTH[o.type],o.x+i>e&&(e=o.x+i)}var n=windspirit.Util.stageW*t.length;return n>e&&(e=n),e},e.prototype.createPlatformByPosition=function(t,e,i){var a=new PlatformNode(t);a.x=e,a.y=i-80,this.m_foregroundNode.addChild(a),this.m_collisionNodes.push(a)},e.prototype.createFruitByPosition=function(t,e,i){var a=new FruitNode(t);a.x=e,a.y=i-a.height,this.m_foregroundNode.addChild(a),this.m_collisionNodes.push(a)},e.prototype.createCatByPosition=function(t,e,i){var a=new CatNode(t);a.x=e,a.y=i-a.height,this.m_foregroundNode.addChild(a),this.m_collisionNodes.push(a)},e.prototype.createStarByPosition=function(t,e){var i=new StarNode;i.x=t,i.y=e-i.height,this.m_foregroundNode.addChild(i),this.m_collisionNodes.push(i)},e.prototype.createGasoilByPosition=function(t,e){var i=new GasoilNode;i.x=t,i.y=e-i.height,this.m_foregroundNode.addChild(i),this.m_collisionNodes.push(i)},e.prototype.createPotionByPosition=function(t,e,i){var a=new PotionNode(t);a.x=e,a.y=i-a.height,this.m_foregroundNode.addChild(a),this.m_collisionNodes.push(a)},e.prototype.createMagnetByPosition=function(t,e){var i=new MagnetNode;i.x=t,i.y=e,this.m_foregroundNode.addChild(i),this.m_collisionNodes.push(i)},e.prototype.createRushByPosition=function(t,e){var i=new RushNode;i.x=t,i.y=e,this.m_foregroundNode.addChild(i),this.m_collisionNodes.push(i)},e.prototype.createSheildByPosition=function(t,e){var i=new SheildNode;i.x=t,i.y=e,this.m_foregroundNode.addChild(i),this.m_collisionNodes.push(i)},e.prototype.createTransformByPosition=function(t,e){var i=new TransformNode;i.x=t,i.y=e,this.m_foregroundNode.addChild(i),this.m_collisionNodes.push(i)},e.prototype.createWingByPosition=function(t,e){var i=new WingNode;i.x=t,i.y=e,this.m_foregroundNode.addChild(i),this.m_collisionNodes.push(i)},e.prototype.createFlagByPosition=function(t,e){var i=new FlagNode;i.x=t,i.y=e,this.m_foregroundNode.addChild(i),this.m_collisionNodes.push(i)},e}(eui.Component);__reflect(GameLayer.prototype,"GameLayer");var BirdStateType;!function(t){t[t.kBirdStateNone=0]="kBirdStateNone",t[t.kBirdStateRunning=1]="kBirdStateRunning",t[t.kBirdStateJump=2]="kBirdStateJump",t[t.kBirdStateJumpRise=3]="kBirdStateJumpRise",t[t.kBirdStateJumpFall=4]="kBirdStateJumpFall",t[t.kBirdStateLand=5]="kBirdStateLand",t[t.kBirdStateDash=6]="kBirdStateDash",t[t.kBirdStatefly=7]="kBirdStatefly",t[t.kBirdStateflying=8]="kBirdStateflying",t[t.kBirdStateSoaring=9]="kBirdStateSoaring",t[t.kBirdStateRolling=10]="kBirdStateRolling",t[t.kBirdStateDead=11]="kBirdStateDead",t[t.kBirdStateMax=12]="kBirdStateMax"}(BirdStateType||(BirdStateType={}));var BirdBufferType;!function(t){t[t.kBirdBufferSheild=1]="kBirdBufferSheild",t[t.kBirdBufferMagnet=2]="kBirdBufferMagnet",t[t.kBirdBufferSpeedup=4]="kBirdBufferSpeedup",t[t.kBirdBufferInvincible=8]="kBirdBufferInvincible",t[t.kBirdBufferRushing=16]="kBirdBufferRushing",t[t.kBirdBufferSoaring=32]="kBirdBufferSoaring",t[t.kBirdBufferTransforming=64]="kBirdBufferTransforming"}(BirdBufferType||(BirdBufferType={}));var PropsType;!function(t){t[t.kPropPotionSmall=0]="kPropPotionSmall",t[t.kPropPotionBig=1]="kPropPotionBig",t[t.kPropMagnet=2]="kPropMagnet",t[t.kPropRush=3]="kPropRush",t[t.kPropSheild=4]="kPropSheild",t[t.kPropTransform=5]="kPropTransform",t[t.kPropWing=6]="kPropWing",t[t.kPropMax=7]="kPropMax"}(PropsType||(PropsType={}));var BirdParticleType;!function(t){t[t.kParticleEatFruit=0]="kParticleEatFruit",t[t.kParticleEatFruitCircle=1]="kParticleEatFruitCircle",t[t.kParticleEatStar=2]="kParticleEatStar",t[t.kParticleBombhit=3]="kParticleBombhit",t[t.kParticleFlyingCycle=4]="kParticleFlyingCycle",t[t.kParticleFlyingWingFeather=5]="kParticleFlyingWingFeather",t[t.kParticleFlyingWingGlow=6]="kParticleFlyingWingGlow",t[t.kParticleEatTransform=7]="kParticleEatTransform",t[t.kParticleEatBigFruit=8]="kParticleEatBigFruit",t[t.kParticleEatBigFruit1=9]="kParticleEatBigFruit1",t[t.kParticleMax=10]="kParticleMax"}(BirdParticleType||(BirdParticleType={}));var BirdActorType;!function(t){t[t.kActorDefaultKiwi=-1]="kActorDefaultKiwi",t[t.kActorPinkKiwi=0]="kActorPinkKiwi",t[t.kActorYellowKiwi=1]="kActorYellowKiwi",t[t.kActorBlueKiwi=2]="kActorBlueKiwi",t[t.kActorKiwiMax=3]="kActorKiwiMax"}(BirdActorType||(BirdActorType={}));var BirdActorAnimationType;!function(t){t[t.kArmatureRunning=0]="kArmatureRunning",t[t.kArmatureJump=1]="kArmatureJump",t[t.kArmatureDead=2]="kArmatureDead",t[t.kArmatureflying=3]="kArmatureflying",t[t.kArmaturelaunching=4]="kArmaturelaunching",t[t.kArmatureSoaring=5]="kArmatureSoaring",t[t.kArmatureRolling=6]="kArmatureRolling",t[t.kArmatureMax=7]="kArmatureMax"}(BirdActorAnimationType||(BirdActorAnimationType={}));var BIRD_MAGNET_LENGTH=600,BIRD_MAGNET_VELOCITY_RATE=600,s_initial_fly_speed=530,BIRD_RESTORE_STA_VALUE=2,BIRD_DASH_FORCE=4200,BIRD_DASH_STA_CONSUME_VALUE=20,BIRD_FLY_STA_CONSUME_VALUE=5,s_soaring_velocity_y=0,PLATFORM_FALLING_TIME=.1,BIRD_GRAVITY_SPEED=-2700,BIRD_SOAR_SPEED=1,BIRD_STOP_SOAR_JUMP_FORCE=1300,RUNNING_TO_FALLING_Y_VELOCITY=PLATFORM_FALLING_TIME*BIRD_GRAVITY_SPEED-30,BIRD_SOAR_JUMP_FORCE=1e3,BIRD_JUMP_FORCE=1200,Bird=function(t){function e(e){var i=t.call(this)||this;return i.m_state=BirdStateType.kBirdStateNone,i.m_animationState=BirdStateType.kBirdStateNone,i.m_isDashing=!1,i.m_isFlying=!1,i.m_isLaunched=!1,i.m_isSoaring=!1,i.m_bufferState=0,i.m_gravity=new egret.Point(0,BIRD_GRAVITY_SPEED),i.m_staminaMax=0,i.m_staminaCur=0,i.m_isChaining=!1,i.m_chains=0,i.m_countTimer=0,i.m_isGamePlaying=!1,i.m_scaleFactor=1,i.m_collisionProps=[],i.m_isNewComer=!1,i.m_actorType=BirdActorType.kActorYellowKiwi,i.m_invincibleDelayTime=5e3,i.m_potionInc=20,i.m_soarDelayTime=3e3,i.m_trackVec=0,i.m_speedFactor=1,i.m_soar_timeout=0,i.m_Delegate=e,i.m_staminaMax=s_bird_stamina_max,i.m_staminaCur=i.m_staminaMax,i.createBone("PinkwalkfoodpdAnimation","bird_running_texture","bird_running_texture_json","bird","running"),i}return __extends(e,t),e.prototype.addParticle=function(){},e.prototype.setScaleFactor=function(t){this.m_scaleFactor=t},e.prototype.setGamePlaying=function(t,e,i){void 0===i&&(i=!1),this.m_isGamePlaying=t,this.m_velocity=new egret.Point(e,0),BIRD_RUN_SPEED=e,this.m_trackVec=BIRD_MAGNET_VELOCITY_RATE,this.m_state=BirdStateType.kBirdStateRunning,egret.setInterval(this.restoreHPHandler,this,1200),this.m_isNewComer=i},e.prototype.restoreHPHandler=function(t){this.m_staminaCur!=this.m_staminaMax&&this.addHP(BIRD_RESTORE_STA_VALUE)},e.prototype.addHP=function(t){this.m_staminaCur+=t,this.m_staminaCur=this.m_staminaCur>this.m_staminaMax?this.m_staminaMax:this.m_staminaCur,this.m_Delegate.updateHP(this.m_staminaCur/this.m_staminaMax),this.m_staminaCur>=BIRD_DASH_STA_CONSUME_VALUE&&this.m_Delegate.didWarning(!1)},e.prototype.speedTo=function(t){this.m_speedFactor=t,this.m_velocity.x=BIRD_RUN_SPEED*t},e.prototype.updateWithDeltaTime=function(t,e){if(this.m_isDashing)for(var i=0;2>i;i++)this.move(t/2),this.m_state!=BirdStateType.kBirdStateDead&&this.checkCollisions(e);else this.move(t),this.m_state!=BirdStateType.kBirdStateDead&&this.checkCollisions(e);this.isBufferOn(BirdBufferType.kBirdBufferMagnet)&&this.track(t,e),this.isBufferOn(BirdBufferType.kBirdBufferTransforming)&&this.transformFruitGreenToRed(e),this.updateState(t)},e.prototype.jump=function(){this.m_state!=BirdStateType.kBirdStateDead&&this.m_state!=BirdStateType.kBirdStateSoaring&&this.m_state!=BirdStateType.kBirdStateflying&&(this.m_state==BirdStateType.kBirdStateLand||this.m_state==BirdStateType.kBirdStateRunning)&&(this.m_velocity.y=BIRD_JUMP_FORCE,this.changeAnimation(BirdStateType.kBirdStateJump),this.m_state=BirdStateType.kBirdStateJumpRise,windspirit.SoundManager.playAudio("soundeffect_jump_mp3"))},e.prototype.dash=function(){this.m_state==BirdStateType.kBirdStateDead||this.m_state==BirdStateType.kBirdStateSoaring||this.m_state==BirdStateType.kBirdStateflying||this.m_isDashing||!this.m_isNewComer&&this.m_staminaCur<BIRD_DASH_STA_CONSUME_VALUE||(this.m_isDashing=!0,this.m_velocity.x=BIRD_RUN_SPEED+BIRD_DASH_FORCE,this.m_velocity.y=0,this.bounceHPBar(BIRD_DASH_STA_CONSUME_VALUE),windspirit.SoundManager.playAudio("soundeffect_dash_mp3"))},e.prototype.bounceHPBar=function(t){this.m_Delegate.bounceHP((this.m_staminaCur-t)/this.m_staminaMax)},e.prototype.getState=function(){return this.m_state},e.prototype.startFlying=function(){this.m_state!=BirdStateType.kBirdStateDead&&this.m_state!=BirdStateType.kBirdStateSoaring&&this.m_state!=BirdStateType.kBirdStateflying&&(this.m_staminaCur<BIRD_FLY_STA_CONSUME_VALUE||this.m_isFlying||(this.updateBirdFlyingImpulse(0),this.m_birdFlyingImpuls=egret.setInterval(this.updateBirdFlyingImpulse,this,150)))},e.prototype.flying=function(t){this.m_state!=BirdStateType.kBirdStateDead&&this.m_state!=BirdStateType.kBirdStateSoaring&&this.m_state!=BirdStateType.kBirdStateflying&&(this.m_isFlying||(this.m_state=BirdStateType.kBirdStatefly,this.changeAnimation(this.m_state)),this.m_velocity.y=this.m_velocity.y+t.y,this.m_isFlying=!0)},e.prototype.updateBirdFlyingImpulse=function(t){return this.m_staminaCur<BIRD_FLY_STA_CONSUME_VALUE?void this.stopFlying():(this.m_velocity.y=0,this.flying(new egret.Point(0,s_initial_fly_speed)),void this.reduceHP(BIRD_FLY_STA_CONSUME_VALUE))},e.prototype.stopFlying=function(){if(egret.clearInterval(this.m_birdFlyingImpuls),this.m_isFlying){if(this.m_isFlying=!1,this.m_state==BirdStateType.kBirdStateDead||this.m_state==BirdStateType.kBirdStateSoaring||this.m_state==BirdStateType.kBirdStateflying)return;
this.m_state=BirdStateType.kBirdStateJumpFall}},e.prototype.transformFruitGreenToRed=function(t){},e.prototype.track=function(t,e){t/=1e3;for(var i=0;i<e.length;i++){var a=e[i];if(a.getObjectType()==GameObjectType.kFruitType||a.getObjectType()==GameObjectType.kStarType){var r=new egret.Point(this.x+this.width/2,this.y+this.height/2),o=new egret.Point(r.x-a.x,r.y-a.y),n=o.length;if(BIRD_MAGNET_LENGTH>n){var s=new egret.Point(o.x/n,o.y/n);s.x*=this.m_trackVec*this.m_speedFactor,s.y*=this.m_trackVec*this.m_speedFactor,this.m_trackVec+=.5;var _=new egret.Point(s.x*t,s.y*t);a.x+=_.x,a.y+=_.y}}}},e.prototype.isBufferOn=function(t){return 0!=(this.m_bufferState&t)},e.prototype.checkCollisions=function(t){for(var e=0;e<t.length;e++){var i=t[e];if(null!=i&&!i.isIgnore()&&i.x-this.x<600&&windspirit.Util.hitTestRect(this,i)){var a=!1;a=this.collisionWithOther(i),a&&(a=i.collisionWithOther(this),a&&this.m_Delegate.didContact(this,i))}}},e.prototype.move=function(t){t/=1e3,this.m_velocity.y+=this.m_gravity.y*t,this.m_isDashing&&this.m_state!=BirdStateType.kBirdStateDead&&(this.m_velocity.x+=s_friction_x*t,this.m_velocity.y=0,this.m_velocity.x<=BIRD_RUN_SPEED*this.m_speedFactor&&(this.m_velocity.x=BIRD_RUN_SPEED*this.m_speedFactor,this.m_velocity.y=200,this.m_isDashing=!1,this.m_isChaining?this.reduceHP(0):this.reduceHP(BIRD_DASH_STA_CONSUME_VALUE),this.m_isChaining=!1)),this.m_isSoaring&&this.m_state!=BirdStateType.kBirdStateDead?(this.m_isLaunched&&(this.changeAnimation(BirdStateType.kBirdStateSoaring),this.m_state=BirdStateType.kBirdStateSoaring,this.m_isLaunched=!1,this.m_gravity.y=-s_soaring_velocity_y,this.m_velocity.y=0,this.setBuffer(BirdBufferType.kBirdBufferSoaring)),this.m_velocity.y=0):this.m_state==BirdStateType.kBirdStateflying&&this.m_velocity.y<=0&&(this.m_isSoaring=!0);var e=new egret.Point(this.m_velocity.x*t,this.m_velocity.y*t);e.x/=this.m_scaleFactor,e.y/=this.m_scaleFactor,this.x+=e.x,this.y-=e.y},e.prototype.updateState=function(t){this.m_state==BirdStateType.kBirdStateLand&&(this.changeAnimation(BirdStateType.kBirdStateRunning),this.m_state=BirdStateType.kBirdStateRunning),this.m_velocity.y<RUNNING_TO_FALLING_Y_VELOCITY&&this.m_state==BirdStateType.kBirdStateRunning&&(this.changeAnimation(BirdStateType.kBirdStateJumpFall),this.m_state=BirdStateType.kBirdStateJumpFall),this.m_velocity.y<0&&this.m_state==BirdStateType.kBirdStateJumpRise&&(this.m_state=BirdStateType.kBirdStateJumpFall),this.trackCollisionDrops(t),this.updateChain(t/1e3)},e.prototype.trackCollisionDrops=function(t){},e.prototype.updateChain=function(t){if(this.m_countTimer>=1.8){if(this.m_chains>0){this.m_Delegate.didStopChain(this.m_chains);var e="soundeffect_combo_convert_score_"+((this.m_chains-1)%5+1)+"_mp3";windspirit.SoundManager.playAudio(e)}this.m_isChaining=!1,this.m_chains=0}else this.m_countTimer+=t},e.prototype.collisionWithOther=function(t){var e=!1;if(this.m_state==BirdStateType.kBirdStateDead)return e;if(null!=t){var i=t.getObjectType();if(i==GameObjectType.kPlatformType)(this.m_velocity.y<=0&&this.m_state==BirdStateType.kBirdStateJumpFall||this.m_state==BirdStateType.kBirdStateRunning)&&this.y+this.height<=t.y+40&&(this.y=t.y-this.height,this.m_velocity.y=0,this.m_state==BirdStateType.kBirdStateJumpFall&&(this.doActionBounce(t),this.runAnimationOnceByName("bird_ground_foot",new egret.Point(this.x,this.y+25)),windspirit.SoundManager.playAudio("soundeffect_bounce_mp3")),this.m_state=BirdStateType.kBirdStateLand),e=!1;else if(i==GameObjectType.kCatType){if(this.m_isDashing||this.isBufferOn(BirdBufferType.kBirdBufferRushing)||this.isBufferOn(BirdBufferType.kBirdBufferSoaring)||this.isBufferOn(BirdBufferType.kBirdBufferInvincible)?e=this.isBufferOn(BirdBufferType.kBirdBufferInvincible)?this.m_isDashing||this.isBufferOn(BirdBufferType.kBirdBufferSoaring)||this.isBufferOn(BirdBufferType.kBirdBufferRushing)?!0:!1:!0:this.isBufferOn(BirdBufferType.kBirdBufferSheild)?(this.stopSheild(),this.invincible(),e=!0):(this.dead(),this.m_Delegate.didGameOver()),e){var a=t.x-t.width/2,r=t.y-t.height/2;this.runAnimationOnceByName("cat_collision",new egret.Point(a,r)),this.setChain(),windspirit.SoundManager.playAudio("soundeffect_kick_mp3");var o=t;null!=o&&o.getCatType()==CatNodeType.kCatNodeFly?windspirit.SoundManager.playAudio("soundeffect_flycat_dead_mp3"):windspirit.SoundManager.playAudio("soundeffect_floorcat_dead_mp3")}}else if(i==GameObjectType.kGasoilType){if(!this.isBufferOn(BirdBufferType.kBirdBufferInvincible)){if(this.isBufferOn(BirdBufferType.kBirdBufferSheild)?(this.stopSheild(),this.invincible()):(this.dead(),this.m_Delegate.didGameOver()),e=!0){var a=t.x-t.width/2,r=t.y-t.height/2;this.runAnimationOnceByName("gasoil_explode",new egret.Point(a,r))}this.addParticleToNode(BirdParticleType.kParticleBombhit,new egret.Point(t.x,t.y),this.parent),windspirit.SoundManager.playAudio("soundeffect_explosion_mp3")}}else if(i==GameObjectType.kFruitType){var a=t.x,r=t.y-t.height/2,n=t.getFruitType();n==FruitNodeType.kFruitTypeBig?(this.addParticleToNode(BirdParticleType.kParticleEatBigFruit,new egret.Point(this.width/2,this.height/2),this,1.8),this.addParticleToNode(BirdParticleType.kParticleEatBigFruit1,new egret.Point(this.width/2,this.height/2),this,1.2),windspirit.SoundManager.playAudio("soundeffect_king_kiwi_eat_mp3")):(this.addParticle(),this.addParticleToNode(BirdParticleType.kParticleEatFruit,new egret.Point(a,r),this.parent),this.addParticleToNode(BirdParticleType.kParticleEatFruitCircle,new egret.Point(a,r),this.parent),windspirit.SoundManager.playAudio("soundeffect_kiwi_eat_mp3")),this.removeProp(t),e=!0,this.setChain()}else if(i==GameObjectType.kStarType){var a=t.x,r=t.y-t.height/2;this.addParticleToNode(BirdParticleType.kParticleEatStar,new egret.Point(a,r),this.parent),this.addParticleToNode(BirdParticleType.kParticleEatFruitCircle,new egret.Point(a,r),this.parent),e=!0,this.setChain(),windspirit.SoundManager.playAudio("soundeffect_score_item_silver_feather_mp3")}else i==GameObjectType.kPotionType?(t.getPotionType()==PotionNodeType.kPotionNodeNormal?(this.addHP(this.m_potionInc),this.doActionDisappear(PropsType.kPropPotionSmall)):(this.addHP(1.5*this.m_potionInc),this.doActionDisappear(PropsType.kPropPotionBig)),windspirit.SoundManager.playAudio("soundeffect_item_mp3"),e=!0):i==GameObjectType.kMagnetType?(this.magnet(),this.doActionDisappear(PropsType.kPropMagnet),windspirit.SoundManager.playAudio("soundeffect_item_mp3"),this.removeProp(t),e=!0):i==GameObjectType.kRushType?(this.rush(),this.doActionDisappear(PropsType.kPropRush),windspirit.SoundManager.playAudio("soundeffect_item_mp3"),this.removeProp(t),e=!0):i==GameObjectType.kWingType?(this.m_state!=BirdStateType.kBirdStateDead&&(this.soar(this.m_soarDelayTime),this.doActionDisappear(PropsType.kPropWing),windspirit.SoundManager.playAudio("soundeffect_item_mp3")),this.removeProp(t),e=!0):i==GameObjectType.kTransformType?(this.transformFruit(),this.doActionDisappear(PropsType.kPropTransform),this.addParticleToNode(BirdParticleType.kParticleEatTransform,new egret.Point(this.width/2,this.height/2),this),windspirit.SoundManager.playAudio("soundeffect_item_mp3"),this.removeProp(t),e=!0):i==GameObjectType.kSheildType?(this.sheild(),this.doActionDisappear(PropsType.kPropSheild),e=!0):i==GameObjectType.kFlagType?e=!0:i==GameObjectType.kBoxType&&(e=!0)}return e},e.prototype.rush=function(){},e.prototype.sheild=function(){},e.prototype.soar=function(t,e){return void 0===e&&(e=BIRD_SOAR_JUMP_FORCE),this.invincible(),this.isBufferOn(BirdBufferType.kBirdBufferSoaring)?(egret.clearTimeout(this.m_soar_timeout),void egret.setTimeout(this.soarBufferTimerOver,this,1e3*t)):(this.m_velocity.y=e+100,this.changeAnimation(BirdStateType.kBirdStateSoaring),this.m_state=BirdStateType.kBirdStateflying,this.m_Delegate.changeSpeed(BIRD_SOAR_SPEED),this.setBuffer(BirdBufferType.kBirdBufferMagnet),egret.setTimeout(this.soarBufferTimerOver,this,1e3*t),void windspirit.SoundManager.playAudio("soundeffect_item_wing_mp3"))},e.prototype.soarBufferTimerOver=function(t){this.stopSoar(),this.invincible()},e.prototype.stopSoar=function(){this.m_isSoaring=!1,this.removeBuffer(BirdBufferType.kBirdBufferSoaring),this.m_velocity.y=BIRD_STOP_SOAR_JUMP_FORCE,this.m_gravity.y=BIRD_GRAVITY_SPEED,this.changeAnimation(BirdStateType.kBirdStateRolling),this.m_state=BirdStateType.kBirdStateJumpFall,this.m_Delegate.resumeSpeed(),this.removeBuffer(BirdBufferType.kBirdBufferMagnet),this.m_Delegate.didEndSoaring()},e.prototype.transformFruit=function(){},e.prototype.magnet=function(){this.isBufferOn(BirdBufferType.kBirdBufferMagnet)||this.runAnimationRepeatByName("magnet_buffer",new egret.Point(this.width/2-10,this.height/2),1),this.setBuffer(BirdBufferType.kBirdBufferMagnet),this.m_trackVec=BIRD_MAGNET_VELOCITY_RATE},e.prototype.runAnimationRepeatByName=function(t,e,i,a){void 0===a&&(a=-1)},e.prototype.doActionDisappear=function(t){},e.prototype.addParticleToNode=function(t,e,i,a,r){void 0===a&&(a=1),void 0===r&&(r=0)},e.prototype.setChain=function(){if(this.m_isDashing&&!this.m_isChaining){this.m_chains++,this.m_isChaining=!0,this.m_countTimer=0,this.m_Delegate.didUpdateChain(this.m_chains);var t="soundeffect_combo_"+((this.m_chains-1)%5+1)+"_mp3";windspirit.SoundManager.playAudio(t)}},e.prototype.dead=function(){this.m_state!=BirdStateType.kBirdStateDead&&(this.changeAnimation(BirdStateType.kBirdStateDead),this.m_state=BirdStateType.kBirdStateDead,this.m_velocity.x=0,this.m_velocity.y=-100,windspirit.SoundManager.playAudio("soundeffect_getHit_mp3"))},e.prototype.stopSheild=function(){},e.prototype.invincible=function(){this.isBufferOn(BirdBufferType.kBirdBufferInvincible)||(this.setBuffer(BirdBufferType.kBirdBufferInvincible),egret.Tween.get(this,{loop:!0}).to({alpha:.2},500).to({alpha:.78},300).wait(200),egret.setTimeout(this.invincibleBufferTimerOver,this,this.m_invincibleDelayTime))},e.prototype.doActionBounce=function(t){egret.Tween.get(t).to({y:t.y+20},1e3*PLATFORM_FALLING_TIME).to({y:t.y},1e3*PLATFORM_FALLING_TIME)},e.prototype.invincibleBufferTimerOver=function(t){this.removeBuffer(BirdBufferType.kBirdBufferInvincible),egret.Tween.removeTweens(this),this.alpha=1},e.prototype.removeBuffer=function(t){this.m_bufferState&=~t},e.prototype.runAnimationOnceByName=function(t,e){},e.prototype.removeProp=function(t){for(var e=0;e<this.m_collisionProps.length;e++)if(this.m_collisionProps[e]==t){this.m_collisionProps.splice(e,1);break}},e.prototype.setBuffer=function(t){this.m_bufferState|=t},e.prototype.changeAnimation=function(t){if(this.m_animationState!=t)switch(this.m_animationState=t,this.removeChildren(),t){case BirdStateType.kBirdStateJump:this.createBone("Pink-jump","bird_jump_texture","bird_jump_texture_json","bird","jump");break;case BirdStateType.kBirdStateRunning:this.createBone("PinkwalkfoodpdAnimation","bird_running_texture","bird_running_texture_json","bird","running");break;case BirdStateType.kBirdStateDead:this.createBone("pink_dead_json","bird_dead_png","bird_dead_json","bird","dead");break;case BirdStateType.kBirdStateSoaring:this.createBone("ActorPinkSoaring_json","bird_soaring_png","bird_soaring_json","bird","fly");break;case BirdStateType.kBirdStatefly:this.createBone("ActorPinkFly_json","bird_fly_png","bird_fly_json","bird","fly");break;case BirdStateType.kBirdStateRolling:this.createBone("ActorPinkRolling_json","bird_rolling_png","bird_rolling_json","bird","rolling");break;default:this.createBone("PinkwalkfoodpdAnimation","bird_running_texture","bird_running_texture_json","bird","running")}},e.prototype.createBone=function(t,e,i,a,r){var o=Util.createArmature(t,e,i,a,r);this.addChild(o.display),this.width=this.height=80,o.display.y=this.height,o.display.x=this.width>>1},e.prototype.reduceHP=function(t){this.m_staminaCur-=t,this.m_staminaCur=this.m_staminaCur<0?0:this.m_staminaCur,this.m_Delegate.updateHP(this.m_staminaCur/this.m_staminaMax),this.m_staminaCur<BIRD_DASH_STA_CONSUME_VALUE&&this.m_Delegate.didWarning(!0)},e}(GameObject);__reflect(Bird.prototype,"Bird");var GasoilNode=function(t){function e(){var e=t.call(this)||this;e.setObjectType(GameObjectType.kGasoilType);var i=new egret.MovieClip(windspirit.Util.create_mcdata("objmc_json","objmc_png","gasoil"));return e.addChild(i),i.play(-1),e}return __extends(e,t),e.prototype.collisionWithOther=function(t){return windspirit.Util.safeRemove(this),!0},e}(GameObject);__reflect(GasoilNode.prototype,"GasoilNode");var GameOverLayer=function(t){function e(){var e=t.call(this,!1)||this;return windspirit.GameData.score=Player.getInstance().tmpPerformanceNum,e.skinName="GameOverSkin",e.labelDis.text=Player.getInstance().tmpDistance+"m",e.labelFruit.text=Player.getInstance().tmpFruitNum.toString(),e.labelCat.text=Player.getInstance().tmpDashCatNum.toString(),e}return __extends(e,t),e}(windspirit.GameOverLayer);__reflect(GameOverLayer.prototype,"GameOverLayer");var HelpLayer=function(t){function e(){var e=t.call(this)||this;return e.skinName="HelpLayerSkin",e.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,e.close,e),e}return __extends(e,t),e.prototype.close=function(){windspirit.Util.safeRemove(this)},e}(eui.Component);__reflect(HelpLayer.prototype,"HelpLayer");var HudLayer=function(t){function e(e,i){var a=t.call(this)||this;return a.m_isWarning=!1,a.m_isClosingChain=!1,a.guide=RES.getRes("guide"),a.skinName="HudLayerSkin",a.m_bird=e,a.m_delegate=i,a.touchLayer.addEventListener(egret.TouchEvent.TOUCH_BEGIN,a.ccTouchesBegan,a),a.touchLayer.addEventListener(egret.TouchEvent.TOUCH_END,a.ccTouchesBegan,a),a.btn_pause.addEventListener(egret.TouchEvent.TOUCH_TAP,a.pause,a),a.btn_resume.addEventListener(egret.TouchEvent.TOUCH_TAP,a.resume,a),a.btn_home.addEventListener(egret.TouchEvent.TOUCH_TAP,Main.ins.createGameScene,Main.ins),a.pauseLayer.visible=!1,a.warningLayer.visible=!1,a.touchLayer.visible=!0,a.m_bgChain.visible=!1,a.m_numChain.visible=!1,a.m_labelChain.visible=!1,a.m_labelReward.visible=!1,a}return __extends(e,t),e.prototype.resume=function(){this.pauseLayer.visible=!1,Player.getInstance().setGameState(GameState.kGameStatePlaying),this.m_delegate.resumeButtonPressed()},e.prototype.removeWarning=function(){this.m_isWarning&&(this.warningLayer.alpha=1,this.warningLayer.visible=!1,this.m_isWarning=!1)},e.prototype.addWarningAction=function(){this.m_isWarning||(this.warningLayer.visible=!0,this.warningLayer.alpha=0,egret.Tween.get(this.warningLayer,{loop:!0}).to({alpha:1},500).to({alpha:0},500).wait(350),this.m_isWarning=!0)},e.prototype.pause=function(t){t.stopImmediatePropagation(),this.pauseLayer.visible=!0;var e=Player.getInstance().getGameState();GameState.kGameStateOver!=e&&GameState.kGameStatePause!=e&&(Player.getInstance().setGameState(GameState.kGameStatePause),this.m_delegate&&this.m_delegate.pauseGame())},e.prototype.changeDistanceNum=function(t){this.m_distanceLabel.text=t+"m"},e.prototype.changeFruitNum=function(t){this.m_fruitNumLabel.text=t.toString()},e.prototype.changePerformanceNum=function(t){this.m_performanceLabel.text=t.toString(),windspirit.Util.setCenterAnchor(this.m_performanceLabel),this.m_performanceLabel.x=this.btn_pause.x-(this.m_performanceLabel.width>>1),this.m_performanceLabel.y=this.btn_pause.y+(this.btn_pause.height>>1)},e.prototype.ccTouchesBegan=function(t){var e=this,i=t.type,a=Player.getInstance().getGameState();if(i==egret.TouchEvent.TOUCH_BEGIN){if((a==GameState.kGameStatePause||a==GameState.kGameStateOver)&&!windspirit.GameData.isNewer)return;this.guide.length;windspirit.GameData.isNewer||this.enableBtn();var r=t.stageX,o=this.m_bird.getState();r<=windspirit.Util.centerX&&(o==BirdStateType.kBirdStateLand||o==BirdStateType.kBirdStateRunning?(this.m_bird.jump(),this.press_timeout=egret.setTimeout(function(){e.m_bird.startFlying()},this,800)):this.m_bird.startFlying(),windspirit.GameData.isNewer&&this.hiddenGuideLayer()),r>windspirit.Util.centerX&&(windspirit.GameData.isNewer&&this.m_delegate,(o==BirdStateType.kBirdStateJump||o==BirdStateType.kBirdStateJumpRise||o==BirdStateType.kBirdStateJumpFall||o==BirdStateType.kBirdStatefly)&&(egret.clearTimeout(this.press_timeout),this.m_bird.stopFlying()),this.m_bird.dash(),windspirit.GameData.isNewer&&this.hiddenGuideLayer())}else if(i==egret.TouchEvent.TOUCH_END){if(GameState.kGameStateOver==a||GameState.kGameStatePause==a)return;egret.clearTimeout(this.press_timeout),this.m_bird.stopFlying()}},e.prototype.enableBtn=function(){},e.prototype.hiddenGuideLayer=function(){},e.prototype.bounceStaminaBar=function(t){this.m_staminaBar.bounceBar(t)},e.prototype.updateStaminaBar=function(t){this.m_staminaBar.updateBar(t)},e.prototype.updateChain=function(t){if(!this.m_isClosingChain){this.m_bgChain.visible=!0,this.m_numChain.visible=!0,this.m_labelChain.visible=!0,this.m_labelReward.visible=!1,windspirit.Util.setScale(this.m_bgChain),windspirit.Util.setScale(this.m_labelReward),windspirit.Util.setScale(this.m_numChain),windspirit.Util.setScale(this.m_labelChain,.8),this.m_numChain.text=t.toString(),windspirit.Util.setCenterAnchor(this.m_numChain),this.m_numChain.y=this.m_bgChain.y,this.m_numChain.x=this.m_bgChain.x-(this.m_numChain.width>>1),egret.Tween.removeTweens(this.m_numChain),egret.Tween.get(this.m_numChain).to({scaleX:3,scaleY:3},120).to({scaleX:1,scaleY:1},120),egret.Tween.removeTweens(this.m_labelChain),egret.Tween.get(this.m_labelChain).to({scaleX:1.5,scaleY:1.5},120).to({scaleX:.8,scaleY:.8},120);var e=windspirit.Util.randClose(1,2),i=Util.createParticle("fx_chain"+e+"_png","fx_chain"+e+"_json");i.x=this.m_bgChain.x,i.y=this.m_bgChain.y,this.addChild(i)}},e.prototype.stopChain=function(t){var e=this;this.m_isClosingChain=!0,this.m_labelReward.text="+"+t,this.m_numChain.visible=!1,this.m_labelChain.visible=!1,this.m_labelReward.visible=!0,egret.Tween.get(this.m_bgChain).wait(500).to({scaleX:.3,scaleY:.3},500,egret.Ease.elasticIn),egret.Tween.get(this.m_labelReward).wait(500).to({scaleX:.3,scaleY:.3},500,egret.Ease.elasticIn).call(function(){e.m_bgChain.visible=!1,e.m_isClosingChain=!1,e.m_labelReward.visible=!1},this);var i=Util.createParticle("fx_chainreward1_png","fx_chainreward1_json");this.addChild(i),i.x=this.m_bgChain.x+90,i.y=this.m_bgChain.y-130;var a=Util.createParticle("fx_chainreward2_png","fx_chainreward2_json");this.addChild(a),a.x=this.m_bgChain.x-50,a.y=this.m_bgChain.y-100;var r=Util.createParticle("ChainScore1_png","ChainScore1_json");r.x=this.m_bgChain.x,r.y=this.m_bgChain.y,this.addChild(r);var o=new egret.Point;o.x=this.m_performanceLabel.x-(this.m_performanceLabel.width>>1),o.y=this.m_performanceLabel.y+(this.m_performanceLabel.height>>1),egret.Tween.get(r).to({x:o.x,y:o.y},500);var n=Util.createParticle("ChainScore2_png","ChainScore2_json");n.x=this.m_bgChain.x,n.y=this.m_bgChain.y,this.addChild(n),egret.Tween.get(n).to({x:o.x,y:o.y},500).call(this.moveParticleCallback,this)},e.prototype.moveParticleCallback=function(){var t=new egret.Point;t.x=this.m_performanceLabel.x-(this.m_performanceLabel.width>>1),t.y=this.m_performanceLabel.y+(this.m_performanceLabel.height>>1);var e=Util.createParticle("fx_chainreward1_png","fx_chainreward1_json");e.x=t.x+100,e.y=t.y-130,this.addChild(e);var i=Util.createParticle("fx_chainreward2_png","fx_chainreward2_json");i.x=t.x-50,i.y=t.y-100,this.addChild(e),egret.Tween.get(this.m_performanceLabel).to({scaleX:2,scaleY:2},250).to({scaleX:1,scaleY:1},250)},e}(eui.Component);__reflect(HudLayer.prototype,"HudLayer");var SettingLayer=function(t){function e(){var e=t.call(this)||this;return e.skinName="SettingLayerSkin",e.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,e.close,e),e.btn_music.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e.music,e),e.btn_music.addEventListener(egret.TouchEvent.TOUCH_END,e.music,e),e.btn_audio.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e.audio,e),e.btn_audio.addEventListener(egret.TouchEvent.TOUCH_END,e.audio,e),e.audioSilde.type=SlideType.audio,e.musicNo.visible=!windspirit.GameData.isMusicOn(),e.audioNo.visible=!windspirit.GameData.isAudioOn(),e}return __extends(e,t),e.prototype.close=function(){windspirit.Util.safeRemove(this)},e.prototype.music=function(t){t.type==egret.TouchEvent.TOUCH_END?(1==this.musicSlide.alpha?(windspirit.SoundManager.stopSound(),this.musicSlide.disable()):(windspirit.SoundManager.resumeSound(),this.musicSlide.enable()),this.btn_music.source="btn-music_png",this.musicNo.visible=!windspirit.GameData.isMusicOn()):this.btn_music.source="btn-music-touched_png"},e.prototype.audio=function(t){t.type==egret.TouchEvent.TOUCH_END?(1==this.audioSilde.alpha?(windspirit.GameData.closeAudio(),this.audioSilde.disable()):(windspirit.GameData.openAudio(),this.audioSilde.enable()),this.audioNo.visible=!windspirit.GameData.isAudioOn(),this.btn_audio.source="btn-audio_png"):this.btn_audio.source="btn-audio-touched_png"},e}(eui.Component);__reflect(SettingLayer.prototype,"SettingLayer");var SlideType;!function(t){t[t.music=0]="music",t[t.audio=1]="audio"}(SlideType||(SlideType={}));var Slide=function(t){function e(){var e=t.call(this)||this;return e.type=SlideType.music,e.startX=0,e.btnStartX=0,e.skinName="SlideSkin",e.btn_volume.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e.touch,e),e.btn_volume.addEventListener(egret.TouchEvent.TOUCH_MOVE,e.touch,e),e.btn_volume.addEventListener(egret.TouchEvent.TOUCH_END,e.touch,e),e}return __extends(e,t),e.prototype.childrenCreated=function(){if(t.prototype.childrenCreated.call(this),this.type==SlideType.music){windspirit.GameData.isMusicOn()?this.enable():this.disable();var e=(this.width-this.btn_volume.width)*windspirit.GameData.localData.music.volume;this.btn_volume.x=e}else{windspirit.GameData.isAudioOn()?this.enable():this.disable();var e=(this.width-this.btn_volume.width)*windspirit.GameData.localData.audio.volume;this.btn_volume.x=e}},e.prototype.touch=function(t){var e=t.type;if(e==egret.TouchEvent.TOUCH_BEGIN)this.btn_volume.source="btn-volume-touched_png",this.startX=t.stageX,this.btnStartX=this.btn_volume.x;else if(e==egret.TouchEvent.TOUCH_MOVE){var i=t.stageX-this.startX;this.btn_volume.x=this.btnStartX+i,this.btn_volume.x<0&&(this.btn_volume.x=0),this.btn_volume.x>this.width-this.btn_volume.width&&(this.btn_volume.x=this.width-this.btn_volume.width);var a=this.btn_volume.x/(this.width-this.btn_volume.width);this.type==SlideType.music?windspirit.SoundManager.setMusicVolume(a):windspirit.GameData.setAudioVolume(a)}else e==egret.TouchEvent.TOUCH_END&&(this.btn_volume.source="btn-volume_png")},e.prototype.enable=function(){this.alpha=1,this.btn_volume.touchEnabled=!0},e.prototype.disable=function(){this.alpha=.5,this.btn_volume.touchEnabled=!1},e}(eui.Component);__reflect(Slide.prototype,"Slide");var StartLayer=function(t){function e(){var e=t.call(this)||this;e.listView.itemRenderer=RankIR;var i=[{nick:"123",avatar:"http://q.qlogo.cn/qqapp/1700002142/D696824889D4F7C363E28BB6E4024A22/100",rank:"1",score:"345"},{nick:"test",avatar:"http://q.qlogo.cn/qqapp/1700002142/D696824889D4F7C363E28BB6E4024A22/100",rank:"2",score:"123"},{nick:"test",avatar:"http://q.qlogo.cn/qqapp/1700002142/D696824889D4F7C363E28BB6E4024A22/100",rank:"2",score:"123"},{nick:"test",avatar:"http://q.qlogo.cn/qqapp/1700002142/D696824889D4F7C363E28BB6E4024A22/100",rank:"2",score:"123"},{nick:"test",avatar:"http://q.qlogo.cn/qqapp/1700002142/D696824889D4F7C363E28BB6E4024A22/100",rank:"2",score:"123"},{nick:"test",avatar:"http://q.qlogo.cn/qqapp/1700002142/D696824889D4F7C363E28BB6E4024A22/100",rank:"2",score:"123"},{nick:"test",avatar:"http://q.qlogo.cn/qqapp/1700002142/D696824889D4F7C363E28BB6E4024A22/100",rank:"2",score:"123"},{nick:"test",avatar:"http://q.qlogo.cn/qqapp/1700002142/D696824889D4F7C363E28BB6E4024A22/100",rank:"2",score:"123"},{nick:"test",avatar:"http://q.qlogo.cn/qqapp/1700002142/D696824889D4F7C363E28BB6E4024A22/100",rank:"2",score:"123"},{nick:"test",avatar:"http://q.qlogo.cn/qqapp/1700002142/D696824889D4F7C363E28BB6E4024A22/100",rank:"2",score:"123"},{nick:"test",avatar:"http://q.qlogo.cn/qqapp/1700002142/D696824889D4F7C363E28BB6E4024A22/100",rank:"2",score:"123"}],a=new eui.ArrayCollection(i);e.listView.dataProvider=a,e.btn_setting.addEventListener(egret.TouchEvent.TOUCH_TAP,e.setting,e),e.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,e.help,e);var r=Util.createArmature("PinkwalkfoodpdAnimation","bird_running_texture","bird_running_texture_json","bird","running");return e.addChild(r.display),r.display.x=e.bmpLights.x+(e.bmpLights.width>>1),r.display.y=e.bmpLights.y+(e.bmpLights.height>>1)+50,e}return __extends(e,t),e.prototype.setting=function(){this.addChild(new SettingLayer)},e.prototype.help=function(){this.addChild(new HelpLayer)},e}(windspirit.StartLayer);__reflect(StartLayer.prototype,"StartLayer");var CatNodeType;!function(t){t[t.kCatNodeFly=1]="kCatNodeFly",t[t.kCatNodeGround=2]="kCatNodeGround"}(CatNodeType||(CatNodeType={}));var CatNodeAnimationType;!function(t){t[t.kCatAnimFly=0]="kCatAnimFly",t[t.kCatAnimGround=1]="kCatAnimGround",t[t.kCatAnimFlyDead=2]="kCatAnimFlyDead",t[t.kCatAnimGroundDead=3]="kCatAnimGroundDead",t[t.kCatAnimJump=4]="kCatAnimJump",t[t.kCatAnimMax=5]="kCatAnimMax"}(CatNodeAnimationType||(CatNodeAnimationType={}));var CatNode=function(t){function e(e){var i,a=t.call(this)||this;i=e==CatNodeType.kCatNodeFly?CatNodeAnimationType.kCatAnimFly:CatNodeAnimationType.kCatAnimGround,a.setObjectType(GameObjectType.kCatType),a.m_type=e;var r=new egret.MovieClip(windspirit.Util.create_mcdata("objmc_json","objmc_png","cat_fly"));return a.addChild(r),r.play(-1),a}return __extends(e,t),e.prototype.getCatType=function(){return this.m_type},e.prototype.doJump=function(){this.m_isSpawned||(this.m_isSpawned=!0,this.setCatDisplayFrame(CatNodeAnimationType.kCatAnimJump))},e.prototype.jumpOverCallBack=function(){this.setCatDisplayFrame(CatNodeAnimationType.kCatAnimGround)},e.prototype.collisionWithOther=function(t){var e=this;if(t){this.removeChildren();var i=new egret.MovieClip(windspirit.Util.create_mcdata("objmc_json","objmc_png","cat_dead"));this.addChild(i),i.play(-1);var a=1;1==windspirit.Util.randClose(0,1)&&(a=-1),egret.Tween.get(this).to({x:this.x+600,y:this.y+120*a},250).to({x:this.x+330,y:this.y-100},650),egret.Tween.get(this).to({alpha:1},1e3).call(function(){windspirit.Util.safeRemove(e)},this)}return!0},e.prototype.setCatDisplayFrame=function(t){},e}(GameObject);__reflect(CatNode.prototype,"CatNode");var GameState;!function(t){t[t.kGameStatePrepare=1]="kGameStatePrepare",t[t.kGameStatePlaying=2]="kGameStatePlaying",t[t.kGameStatePause=3]="kGameStatePause",t[t.kGameStatePreOver=4]="kGameStatePreOver",t[t.kGameStateOver=5]="kGameStateOver"}(GameState||(GameState={}));var BACKGROUND_TYPE;!function(t){t[t.kBgNone=-1]="kBgNone",t[t.kBgForest=0]="kBgForest",t[t.kBgDarkForest=1]="kBgDarkForest",t[t.kBgBeach=2]="kBgBeach",t[t.kBgDesert=3]="kBgDesert",t[t.kBgMax=4]="kBgMax"}(BACKGROUND_TYPE||(BACKGROUND_TYPE={}));var GAME_OBJECT_NAME_TYPE;!function(t){t[t.GAME_OBJECT_PLATFORM_TYPE_1=0]="GAME_OBJECT_PLATFORM_TYPE_1",t[t.GAME_OBJECT_PLATFORM_TYPE_2=1]="GAME_OBJECT_PLATFORM_TYPE_2",t[t.GAME_OBJECT_PLATFORM_TYPE_3=2]="GAME_OBJECT_PLATFORM_TYPE_3",t[t.GAME_OBJECT_PLATFORM_TYPE_4=3]="GAME_OBJECT_PLATFORM_TYPE_4",t[t.GAME_OBJECT_PLATFORM_TYPE_5=4]="GAME_OBJECT_PLATFORM_TYPE_5",t[t.GAME_OBJECT_PLATFORM_TYPE_6=5]="GAME_OBJECT_PLATFORM_TYPE_6",t[t.GAME_OBJECT_PLATFORM_TYPE_7=6]="GAME_OBJECT_PLATFORM_TYPE_7",t[t.GAME_OBJECT_PLATFORM_TYPE_8=7]="GAME_OBJECT_PLATFORM_TYPE_8",t[t.GAME_OBJECT_PLATFORM_TYPE_9=8]="GAME_OBJECT_PLATFORM_TYPE_9",t[t.GAME_OBJECT_PLATFORM_TYPE_10=9]="GAME_OBJECT_PLATFORM_TYPE_10",t[t.GAME_OBJECT_FRUIT_GREEN_TYPE=10]="GAME_OBJECT_FRUIT_GREEN_TYPE",t[t.GAME_OBJECT_FRUIT_RED_TYPE=11]="GAME_OBJECT_FRUIT_RED_TYPE",t[t.GAME_OBJECT_FRUIT_BIG_TYPE=12]="GAME_OBJECT_FRUIT_BIG_TYPE",t[t.GAME_OBJECT_CAT_FLY_TYPE=13]="GAME_OBJECT_CAT_FLY_TYPE",t[t.GAME_OBJECT_CAT_GROUND_TYPE=14]="GAME_OBJECT_CAT_GROUND_TYPE",t[t.GAME_OBJECT_STAR_TYPE=15]="GAME_OBJECT_STAR_TYPE",t[t.GAME_OBJECT_GASOIL_TYPE=16]="GAME_OBJECT_GASOIL_TYPE",t[t.GAME_OBJECT_POTION_NORMAL_TYPE=17]="GAME_OBJECT_POTION_NORMAL_TYPE",t[t.GAME_OBJECT_POTION_BIG_TYPE=18]="GAME_OBJECT_POTION_BIG_TYPE",t[t.GAME_OBJECT_MAGNET_TYPE=19]="GAME_OBJECT_MAGNET_TYPE",t[t.GAME_OBJECT_RUSH_TYPE=20]="GAME_OBJECT_RUSH_TYPE",t[t.GAME_OBJECT_SHEILD_TYPE=21]="GAME_OBJECT_SHEILD_TYPE",t[t.GAME_OBJECT_TRANSFORM_TYPE=22]="GAME_OBJECT_TRANSFORM_TYPE",t[t.GAME_OBJECT_WING_TYPE=23]="GAME_OBJECT_WING_TYPE",t[t.GAME_OBJECT_FLAG_TYPE=24]="GAME_OBJECT_FLAG_TYPE",t[t.GAME_OBJECT_BOX_TYPE=25]="GAME_OBJECT_BOX_TYPE",t[t.GAME_OBJECT_MAX=26]="GAME_OBJECT_MAX"}(GAME_OBJECT_NAME_TYPE||(GAME_OBJECT_NAME_TYPE={}));var GamePropSlotType;!function(t){t[t.kPropSlotSheild=1]="kPropSlotSheild",t[t.kPropSlotFirstSoar=2]="kPropSlotFirstSoar",t[t.kPropSlotEndSoar=4]="kPropSlotEndSoar",t[t.kPropSlotStaminaUp=8]="kPropSlotStaminaUp",t[t.kPropSlotFruitBoost=16]="kPropSlotFruitBoost",t[t.kPropSlotMax=17]="kPropSlotMax"}(GamePropSlotType||(GamePropSlotType={}));var BG_POINTS_PER_SEC_TYPE;!function(t){t[t.FARGROUND_POINTS_PER_SEC=0]="FARGROUND_POINTS_PER_SEC",t[t.MIDDLEGROUND_POINTS_PER_SEC=1]="MIDDLEGROUND_POINTS_PER_SEC",t[t.OBJECTGROUND_POINTS_PER_SEC=2]="OBJECTGROUND_POINTS_PER_SEC",t[t.NEARGROUND_POINTS_PER_SEC=3]="NEARGROUND_POINTS_PER_SEC",t[t.FOREGROUND_POINTS_PER_SEC=4]="FOREGROUND_POINTS_PER_SEC",t[t.CLOUDGROUND_POINTS_PER_SEC=5]="CLOUDGROUND_POINTS_PER_SEC",t[t.POINTS_PER_SEC_MAX=6]="POINTS_PER_SEC_MAX"}(BG_POINTS_PER_SEC_TYPE||(BG_POINTS_PER_SEC_TYPE={}));var s_bg_points_per_sec=[70,150,250,300,360,50],s_friction_x=-3e4,s_bird_stamina_max=100,s_game_object_name_type=["platform-1","platform-2","platform-3","platform-4","platform-5","platform-6","platform-7","platform-8","platform-9","platform-10","fruit-green","fruit-red","fruit-big","cat-fly","cat-ground","star","gasoil","potion-normal","potion-big","magnet","rush","sheild","transform","wing","flag","box"],GAME_DASH_CAT_SCORE=10,GAME_OBJECT_STAR_SCORE=5,GAME_OBJECT_FRUIT_SCORE=10,PLAYER_START_POSITION_X=200,PLAYER_START_POSITION_Y=560,FOREGROUND_SCALE_FACTOR=.8,GAME_DISTANCE_SCORE=2,BIRD_RUN_SPEED=360,OBJ_WIDTH={"platform-1":1872,"platform-2":1728,"platform-3":1584,"platform-4":1344,"platform-5":1104,"platform-6":960,"platform-7":768,"platform-8":576,"platform-9":432,"platform-10":288,"fruit-green":53,"fruit-red":53,"fruit-big":106,"cat-fly":148,"cat-ground":180,star:51,gasoil:81,"potion-normal":66,"potion-big":93,magnet:81,rush:82,sheild:121,transform:87,wing:88,flag:80,box:80},Main=function(t){function e(){var i=this,a={appId:"bird",heart:!0,showLogo:!1};return i=t.call(this,a)||this,e.ins=i,egret.Ticker.getInstance().register(function(t){dragonBones.WorldClock.clock.advanceTime(t/1e3)},i),i}return __extends(e,t),e.prototype.createGameScene=function(){this.gameLayer.removeChildren();var t=new StartLayer;t.addEventListener(windspirit.EVENT_START_GAME,this.start,this),this.gameLayer.addChild(t)},e.prototype.start=function(){this.gameLayer.removeChildren(),windspirit.SoundManager.playSound("bgm_main_mp3"),this.game=new GameLayer,this.gameLayer.addChild(this.game)},e.prototype.restart=function(){this.game.backHome()},e}(windspirit.App);__reflect(Main.prototype,"Main");var PlatformNodeType;!function(t){t[t.kPlatformTypeTMX1=0]="kPlatformTypeTMX1",t[t.kPlatformTypeTMX2=1]="kPlatformTypeTMX2",t[t.kPlatformTypeTMX3=2]="kPlatformTypeTMX3",t[t.kPlatformTypeTMX4=3]="kPlatformTypeTMX4",t[t.kPlatformTypeTMX5=4]="kPlatformTypeTMX5",t[t.kPlatformTypeTMX6=5]="kPlatformTypeTMX6",t[t.kPlatformTypeTMX7=6]="kPlatformTypeTMX7",t[t.kPlatformTypeTMX8=7]="kPlatformTypeTMX8",t[t.kPlatformTypeTMX9=8]="kPlatformTypeTMX9",t[t.kPlatformTypeTMX10=9]="kPlatformTypeTMX10",t[t.kPlatformTypeMax=10]="kPlatformTypeMax"}(PlatformNodeType||(PlatformNodeType={}));var PlatformNode=function(t){function e(e){var i=t.call(this)||this;i.setObjectType(GameObjectType.kPlatformType);var a=windspirit.Util.zfill(e+1,3),r=egret.XML.parse(RES.getRes(a)),o=parseInt(r.$tilewidth)*parseInt(r.$width),n=new tiled.TMXTilemap(o,80,r,"resource/assets/map/");return n.render(),i.addChild(n),i.width=o,i.height=1,i
}return __extends(e,t),e.prototype.collisionWithOther=function(t){return!1},e}(GameObject);__reflect(PlatformNode.prototype,"PlatformNode");var Player=function(){function t(){this.tmpFruitNum=0,this.tmpPerformanceNum=0,this.tmpDashCatNum=0,this.tmpDistance=0,this.tmpAwardScore=0}return t.prototype.addPerformance=function(t){this.tmpPerformanceNum+=t},t.prototype.initResult=function(){this.tmpDistance=0,this.tmpDashCatNum=0,this.tmpFruitNum=0,this.tmpPerformanceNum=0,this.tmpAwardScore=0},t.getInstance=function(){return this._ins||(this._ins=new t),this._ins},t.prototype.getGameState=function(){return this.m_gameState},t.prototype.setGameState=function(t){this.m_gameState=t},t}();__reflect(Player.prototype,"Player");var PotionNodeType;!function(t){t[t.kPotionNodeNormal=0]="kPotionNodeNormal",t[t.kPotionNodeBig=1]="kPotionNodeBig",t[t.kPotionNodeMax=2]="kPotionNodeMax"}(PotionNodeType||(PotionNodeType={}));var PotionNode=function(t){function e(e){var i=t.call(this)||this;return i.setObjectType(GameObjectType.kPotionType),i.m_type=e,e==PotionNodeType.kPotionNodeNormal?i.addChild(new egret.Bitmap(RES.getRes("item-potion-normal_png"))):i.addChild(new egret.Bitmap(RES.getRes("item-potion-big_png"))),i}return __extends(e,t),e.prototype.getPotionType=function(){return this.m_type},e.prototype.collisionWithOther=function(t){var e=this;return t&&(this.anchorOffsetX=this.width>>1,this.anchorOffsetY=this.height>>1,egret.Tween.get(this).to({scaleX:3,scaleY:3,alpha:0},500).call(function(){windspirit.Util.safeRemove(e)},this)),!0},e}(GameObject);__reflect(PotionNode.prototype,"PotionNode");var RankIR=function(t){function e(){var e=t.call(this)||this;return e.skinName="RankIRSkin",e}return __extends(e,t),e}(eui.ItemRenderer);__reflect(RankIR.prototype,"RankIR");var RushNode=function(t){function e(){var e=t.call(this)||this;return e.setObjectType(GameObjectType.kRushType),e.addChild(new egret.Bitmap(RES.getRes("ShopBuyEndRun"))),e}return __extends(e,t),e}(GameObject);__reflect(RushNode.prototype,"RushNode");var SheildNode=function(t){function e(){var e=t.call(this)||this;return e.setObjectType(GameObjectType.kSheildType),e.addChild(new egret.Bitmap(RES.getRes("ShopBuyEndRun"))),e}return __extends(e,t),e}(GameObject);__reflect(SheildNode.prototype,"SheildNode");var BAR_SCALE_FACTOR=10,StaminaBarNode=function(t){function e(){var e=t.call(this)||this;return e.m_grownFactor=1,e.m_prevPercentage=1,e.skinName="StaminaBarSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.m_staMiddleBg.x=this.staLeftCornetBg.width,this.m_staMiddleBg.scaleX=BAR_SCALE_FACTOR*this.m_grownFactor,this.m_staMiddleIn.x=this.staLeftCornet.width,this.m_staMiddleIn.scaleX=BAR_SCALE_FACTOR*this.m_grownFactor,this.m_staMiddle.x=this.staLeftCornet.width,this.m_staMiddle.scaleX=BAR_SCALE_FACTOR*this.m_grownFactor,this.m_staRightCornetBg.x=this.m_staMiddleBg.x+this.m_staMiddleBg.width*this.m_staMiddleBg.scaleX-7,this.m_staRightCornetIn.x=this.m_staMiddleIn.x+this.m_staMiddleIn.width*this.m_staMiddleIn.scaleX,this.m_staRightCornet.x=this.m_staMiddle.x+this.m_staMiddle.width*this.m_staMiddle.scaleX},e.prototype.updateBar=function(t){this.m_staMiddle.scaleX=BAR_SCALE_FACTOR*this.m_grownFactor*t;1==t||t<this.m_prevPercentage||t>this.m_prevPercentage,this.m_prevPercentage=t,this.updatePositionAfterScale()},e.prototype.updatePositionAfterScale=function(){this.m_staRightCornet.x=this.m_staMiddle.x+this.m_staMiddle.width*this.m_staMiddle.scaleX},e.prototype.bounceBar=function(t){this.m_staMiddle.scaleX=BAR_SCALE_FACTOR*this.m_grownFactor*t,this.updatePositionAfterScale()},e.prototype.setGrownFactor=function(t){this.m_grownFactor=t,this.m_staMiddleBg.scaleX=BAR_SCALE_FACTOR*this.m_grownFactor,this.m_staMiddle.scaleX=BAR_SCALE_FACTOR*this.m_grownFactor,this.updatePositionAfterScale()},e}(eui.Component);__reflect(StaminaBarNode.prototype,"StaminaBarNode");var StarNode=function(t){function e(){var e=t.call(this)||this;return e.setObjectType(GameObjectType.kStarType),e.addChild(new windspirit.Bitmap("item-star1_png")),e}return __extends(e,t),e}(GameObject);__reflect(StarNode.prototype,"StarNode");var TransformNode=function(t){function e(){var e=t.call(this)||this;return e.setObjectType(GameObjectType.kTransformType),e.addChild(new egret.Bitmap(RES.getRes("ShopBuyEndRun"))),e}return __extends(e,t),e}(GameObject);__reflect(TransformNode.prototype,"TransformNode");var Util=function(){function t(){}return t.createParticle=function(t,e){var i=RES.getRes(e),a=new particle.GravityParticleSystem(RES.getRes(t),i);return a.start(i.duration),windspirit.Util.setCenterAnchor(a),egret.setTimeout(function(){windspirit.Util.safeRemove(a)},this,1500),a},t.createArmature=function(t,e,i,a,r){var o=RES.getRes(t),n=RES.getRes(i),s=RES.getRes(e),_=new dragonBones.EgretFactory;_.addDragonBonesData(dragonBones.DataParser.parseDragonBonesData(o)),_.addTextureAtlas(new dragonBones.EgretTextureAtlas(s,n));var d=_.buildArmature(a);return dragonBones.WorldClock.clock.clear(),dragonBones.WorldClock.clock.add(d),d.animation.gotoAndPlay(r),d},t}();__reflect(Util.prototype,"Util");var WingNode=function(t){function e(){var e=t.call(this)||this;return e.setObjectType(GameObjectType.kWingType),e}return __extends(e,t),e}(GameObject);__reflect(WingNode.prototype,"WingNode");